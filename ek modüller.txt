find . -type f -mtime -1âœ… 4. PSÄ°KOLOJÄ°K DURUM TESTÄ° â€“ Evet / HayÄ±r SorularÄ± (ModÃ¼l: psychCheckGate.js)
ğŸ“‹ 10 Soruluk Ã–nerilen Set
ğŸ”¹ Karar Ã¶ncesi kullanÄ±cÄ±ya sorulacak:
Son 10 dakikada SL aldÄ±n mÄ±?

Kendini ÅŸu an sakin ve net dÃ¼ÅŸÃ¼nen biri olarak gÃ¶rÃ¼yor musun?

Bu iÅŸleme girmekte teknik bir gerekÃ§en var mÄ±?

Bu pozisyon seni heyecanlandÄ±rÄ±yor mu (fazla)?

KÃ¢r alma konusunda hÃ¢lÃ¢ net misin?

Bu iÅŸlem seni zarardan kurtarmak iÃ§in mi yapÄ±lÄ±yor?

Son iÅŸleminden sonra kendine kÄ±zdÄ±n mÄ±?

Bu pozisyonun bÃ¼yÃ¼klÃ¼ÄŸÃ¼ seni korkutuyor mu?

Åu an â€œbu sefer kesin olacakâ€ diye dÃ¼ÅŸÃ¼ndÃ¼n mÃ¼?

DÃ¼nkÃ¼ planÄ±na sadÄ±k mÄ±sÄ±n?

KullanÄ±cÄ±dan bu sorulara Evet / HayÄ±r ÅŸeklinde cevap alÄ±nÄ±r.
3 veya daha fazla â€œkÄ±rmÄ±zÄ± cevapâ€ varsa:

Ä°ÅŸlem 3 dakika ertelenir

LIVIA â€œduygusal baskÄ±â€ uygular

VIVOâ€™ya â€œsinyal baskÄ± Ã¶nerisiâ€ gÃ¶nderilir

Denetim AsistanÄ±â€™na: decisionBiasDetected etiketiyle log bÄ±rakÄ±lÄ±r
_________________________________________________________________________________________________________________
technicalIndicatorsEngine.js â€“ GELÄ°ÅMÄ°Å PROMPT (GRAFÄ°K BEYNÄ° ENTEGRASYONLU)
ğŸ¯ AMAÃ‡:
Binanceâ€™ten alÄ±nan OHLCV datasÄ±nÄ± kullanarak EMA, RSI, MACD, Bollinger Band, VWAP, ATR gibi gÃ¶stergeleri modÃ¼ler ve Ã§aÄŸrÄ±labilir formatta hesaplar.
Ã‡Ä±ktÄ±lar, tÃ¼m sistem modÃ¼lleri tarafÄ±ndan getIndicators() fonksiyonu Ã¼zerinden eriÅŸilebilir.

âš™ï¸ TEKNÄ°K GÄ°RDÄ°LER:
Binance endpoint:
/api/v3/klines?symbol=BTCUSDT&interval=5m&limit=200

Format:
OHLCV: [timestamp, open, high, low, close, volume]

ğŸ”¢ HESAPLANACAK GÃ–STERGELER:
GÃ¶sterge	Parametre	KullanÄ±ldÄ±ÄŸÄ± ModÃ¼ller
EMA	9 / 21 / 50 / 200	trendFilter.js, falseBreakFilter.js, volumeConfirmBreakout.js
RSI	14	comboBreakDetector.js, rsiDivergenceChecker.js
MACD	(12, 26, 9)	comboBreakDetector.js, signalMaturityScorer.js
Bollinger Band	20 / 2.0 std	volatilityClampFilter.js
ATR	14	adaptiveScenarioBuilder.js, riskScaler.js
VWAP	GÃ¼nlÃ¼k	vwapZoneDetector.js, liquidityBiasGuard.js

ğŸ“¤ EXPORT FORMAT:
json
Kopyala
DÃ¼zenle
{
  "symbol": "BTCUSDT",
  "interval": "5m",
  "timestamp": 1720352400000,
  "indicators": {
    "ema21": 67102.15,
    "ema50": 67011.24,
    "rsi14": 58.31,
    "macd": {
      "line": -1.25,
      "signal": -1.03,
      "histogram": -0.22
    },
    "bollinger": {
      "upper": 67300.2,
      "middle": 67025.3,
      "lower": 66750.4
    },
    "atr14": 120.23,
    "vwap": 67081.76
  }
}
ğŸ”§ MODÃœLLERLE ENTEGRASYON:
Ã–rnek: falseBreakFilter.js
js
Kopyala
DÃ¼zenle
const indicators = getIndicators("BTCUSDT", "5m");

if (price > indicators.ema21 && rsi < 50) {
  return "weak_breakout";
}
Ã–rnek: comboBreakDetector.js
js
Kopyala
DÃ¼zenle
if (
  indicators.macd.histogram > 0 &&
  indicators.rsi14 > 55 &&
  price > indicators.ema21
) {
  return "high_confidence_combo";
}
ğŸ” GÃœNCELLEME ZAMANI & CACHE YAPISI:
GÃ¶sterge verisi her 1 dakikada bir Ã§ekilir

EÄŸer aynÄ± dakikada tekrar Ã§aÄŸrÄ±lÄ±rsa cacheâ€™den verilir

FarklÄ± semboller iÃ§in ayrÄ± cache tutulur (BTCUSDT, ETHUSDT vs.)

âš ï¸ HATA YÃ–NETÄ°MÄ°:
Binance veri gecikirse retry 3

GÃ¶sterge hesaplamasÄ± sÄ±rasÄ±nda hata olursa null dÃ¶nmez, NaN-safe default deÄŸer verir

Her gÃ¶sterge isValid() fonksiyonuyla kontrol edilebilir

âœ… EKSTRA AVANTAJLAR:
Ã‡oklu zaman dilimi desteÄŸi eklenebilir (Ã¶rn: 5m + 1h + 1d)

Custom sinyal modÃ¼lleri bu motora baÄŸlanabilir

TÃ¼m teknik kararlar artÄ±k bu motoru baz alÄ±r, kod tekrarÄ±nÄ± azaltÄ±r

Bu motoru kurduÄŸumuzda, artÄ±k ÅŸu sorularÄ± sormak mÃ¼mkÃ¼n:

â€œEMA21 altÄ±nda RSI dÃ¼ÅŸÃ¼yorsa, formasyon zayÄ±f mÄ±?â€

â€œTP gelen stratejiler hangi volatilite seviyelerinde baÅŸarÄ±lÄ±?â€

â€œHacim desteÄŸi olmayan kÄ±rÄ±lÄ±mlarÄ± filtreleyelim mi?â€

 technicalIndicatorsEngine.js â€“ KODLAMA PROMPTU
ğŸ¯ GÃ¶rev:
Binance API Ã¼zerinden OHLCV verisi Ã§ekerek teknik gÃ¶stergeleri (EMA, RSI, MACD, Bollinger, ATR, VWAP) hesaplar ve diÄŸer modÃ¼llere veri saÄŸlar.

ğŸ§  GeliÅŸmiÅŸ Prompt (KodlayÄ±cÄ±ya):
technicalIndicatorsEngine.js adÄ±nda bir Node.js modÃ¼lÃ¼ oluÅŸtur.
Bu modÃ¼l Binanceâ€™ten OHLCV verisi (/api/v3/klines) alarak aÅŸaÄŸÄ±daki gÃ¶stergeleri hesaplayacak ÅŸekilde tasarlanmalÄ±:

EMA: 9, 21, 50, 200

RSI: 14

MACD: (12, 26, 9)

Bollinger Bands: 20 periyot, 2 std

ATR: 14

VWAP (gÃ¼nlÃ¼k hacim aÄŸÄ±rlÄ±klÄ± ortalama fiyat)

ğŸ›  KÃ¼tÃ¼phaneler:
axios â†’ Binance APIâ€™den veri Ã§ekmek iÃ§in

technicalindicators (NPM modÃ¼lÃ¼) â†’ GÃ¶stergeleri hesaplamak iÃ§in

lodash â†’ veri iÅŸleme kolaylÄ±ÄŸÄ± iÃ§in (isteÄŸe baÄŸlÄ±)

âš™ï¸ Fonksiyon: getIndicators(symbol, interval)
Girdi:
js
Kopyala
DÃ¼zenle
{
  symbol: "BTCUSDT",
  interval: "5m"
}
Ã‡Ä±ktÄ±:
json
Kopyala
DÃ¼zenle
{
  "symbol": "BTCUSDT",
  "interval": "5m",
  "timestamp": 1720352400000,
  "indicators": {
    "ema21": 67102.15,
    "ema50": 67011.24,
    "rsi14": 58.31,
    "macd": {
      "line": -1.25,
      "signal": -1.03,
      "histogram": -0.22
    },
    "bollinger": {
      "upper": 67300.2,
      "middle": 67025.3,
      "lower": 66750.4
    },
    "atr14": 120.23,
    "vwap": 67081.76
  }
}
ğŸ”„ Ã–zellikler:
Veriler axios ile Binanceâ€™tan alÄ±nmalÄ±

GÃ¶stergeler technicalindicators fonksiyonlarÄ±yla hesaplanmalÄ±

Hesaplamalar iÃ§in close, high, low, volume dizileri Ã§Ä±karÄ±lmalÄ±

VWAP, gÃ¼n iÃ§indeki volume * typicalPrice toplamÄ± / volume toplamÄ± ile hesaplanmalÄ±

Hesaplama sonucunda NaN deÄŸer varsa, null yerine 0.0 veya isValid: false etiketi dÃ¶nmeli

ğŸ—‚ Ek Ã–zellikler:
Fonksiyon Promise dÃ¶ner (async/await yapÄ±sÄ± desteklenmeli)

Her symbol-interval iÃ§in cache tutulmalÄ±, 1 dakikada bir yenilenmeli

HatalÄ± veri varsa console.warn() ile uyarÄ± atÄ±lmalÄ±

EÄŸer Binance API sÄ±nÄ±rÄ±na ulaÅŸÄ±ldÄ±ysa retry sistemi kurulmalÄ± (max 3)

ğŸ“ Dosya YapÄ±sÄ± Ã–nerisi:
bash
Kopyala
DÃ¼zenle
/lib
  â””â”€â”€ technical/
        â””â”€â”€ indicators/
              â”œâ”€â”€ emaUtils.js
              â”œâ”€â”€ rsiUtils.js
              â”œâ”€â”€ macdUtils.js
              â””â”€â”€ getIndicators.js  <-- ana giriÅŸ
Bu prompt ile, direkt olarak technicalIndicatorsEngine.js kodlanabilir.
Kodun Ã§Ä±ktÄ±sÄ± tÃ¼m sistem modÃ¼llerine baÄŸÄ±msÄ±z teknik analiz katmanÄ± saÄŸlar

_________________________________________________________________________________________________________________

ğŸ” 1. HABER VERÄ°SÄ° KULLANAN MODÃœLLER ANALÄ°ZÄ°
ğŸ“ˆ Grafik Beyni:
ModÃ¼l	Haberle EtkileÅŸimi
reflexivePatternTracker.js	Haber sonrasÄ± anormal fiyat sÄ±Ã§ramasÄ±nÄ± izler
adaptiveScenarioBuilder.js	â€œHaber etkisi ortamÄ±â€ tespiti yapar
falseBreakFilter.js	Haber etkisiyle gelen fake breakout'larÄ± bastÄ±rÄ±r
volumeConfirmBreakout.js	Habersiz gelen hacim artÄ±ÅŸÄ± uyarÄ±sÄ± verir

ğŸ›¡ï¸ LIVIA:
ModÃ¼l	Haberle EtkileÅŸimi
emotionalDefenseLauncher.js	Haber paniÄŸi tespiti yapar
contextSuppressionTrigger.js	Haber sebebiyle sinyal baskÄ±lar
emergencyHoldActivator.js	â€œHaberde Ã§Ã¶kÃ¼ÅŸ/hackâ€ gibi kelimeler geÃ§iyorsa sistemleri geÃ§ici durdurur

ğŸ§  Denetim AsistanÄ±:
ModÃ¼l	Haberle EtkileÅŸimi
macroDisruptionLog.js	Makro/kriz haberlerini kaydeder
strategyIntegrityEvaluator.js	Haber sonrasÄ± strateji baÅŸarÄ±sÄ±nÄ± deÄŸerlendirir
formationPerformanceTracker.js	Haber etkili formasyonlarÄ±n baÅŸarÄ± oranÄ±nÄ± izler

ğŸ§  2. GELÄ°ÅMÄ°Å newsFetcher.js SÄ°STEM TASARIMI
ğŸ¯ GÃ¶rev:
Haberleri Ã§ekmekle kalmaz, sistemlerin anlayabileceÄŸi ÅŸekilde iÅŸler, etki dÃ¼zeyini belirler, gerektiÄŸinde sistemleri uyarÄ±r, bastÄ±rÄ±r veya log atar.

ğŸ§© MODÃœL BÄ°LEÅENLERÄ°:
ğŸŸ¦ A. Anahtar Kelime Sistemi
Kategori	Anahtar Kelimeler	Etki
RegÃ¼lasyon	SEC, ban, regulation, illegal	risk yÃ¼ksek
Onay	ETF approval, listing	fiyat sÄ±Ã§ramasÄ±
Hack / Ã‡Ã¶kÃ¼ÅŸ	exploit, hacked, down, rug	iÅŸlem kilidi
Makro Kriz	inflation, debt, credit, Fed	ortam deÄŸiÅŸimi

ğŸŸ§ B. Sistem Entegrasyon HaritasÄ±
Tetik	Etkilenecek ModÃ¼ller	Etki
ETF onayÄ± â†’	reflexivePatternTracker, comboBreakDetector, emotionalDefenseLauncher	ani sinyal Ã¼retimi / baskÄ±
Hack haberi â†’	emergencyHoldActivator, macroDisruptionLog, adaptiveScenarioBuilder	sistem durdurulur / log atÄ±lÄ±r
Regulation â†’	contextSuppressionTrigger, strategyIntegrityEvaluator	agresif strateji baskÄ±lanÄ±r

ğŸ“¦ Ã‡IKTI FORMAT (newsFetcher.js)
json
Kopyala
DÃ¼zenle
{
  "timestamp": "2025-07-21T18:12:00Z",
  "title": "Bitcoin ETF Approved by SEC",
  "source": "Bloomberg",
  "impactCategory": "ETF approval",
  "impactTag": "price_jump",
  "triggeredModules": [
    "reflexivePatternTracker.js",
    "adaptiveScenarioBuilder.js",
    "emotionalDefenseLauncher.js"
  ],
  "affectedSystems": ["Grafik Beyni", "LIVIA"],
  "suggestedAction": "Prepare for volatility spike"
}
âš™ï¸ GELÄ°ÅMÄ°Å FONKSÄ°YON YAPISI:
ğŸ”§ newsFetcher.js Ä°ÅŸlevleri:
fetchNews(keywords)

NewsAPIâ€™den haber Ã§eker

Default kelimeler: "bitcoin", "crypto", "SEC", "ETF", "hack", "ban", "regulation", "approval"

classifyImpact(newsItem)

Tetikleyici kelimeleri tarar

Etki kategorisi belirler: "price_jump", "panic", "macro_shift"

generateSystemActions(impact)

Etkilenecek modÃ¼lleri belirler

Hangi sistem nasÄ±l cevap vermeli Ã§Ä±karÄ±r

logToAssistant()

Denetim AsistanÄ±â€™na olay kaydÄ± gÃ¶nderir

ğŸ” GÃ¼ncellenme & Cron
Her 30 dakikada bir Ã§aÄŸrÄ±lÄ±r

scheduler.js veya dÄ±ÅŸ sistemden tetiklenir

Geriye getNewsImpact() ile sistemler veriyi Ã§eker

ğŸ”§ KODLAMA PROMPTU
newsFetcher.js adÄ±nda bir Node.js modÃ¼lÃ¼ oluÅŸtur.
NewsAPIâ€™den her 30 dakikada haber Ã§eker.
Belirli tetikleyici kelimelere gÃ¶re haberleri sÄ±nÄ±flandÄ±rÄ±r (regulation, approval, hack, macro).
Bu haberler:

Hangi sistemleri etkilerse o modÃ¼llere iÅŸaret gÃ¶nderir

Denetim AsistanÄ±â€™na olay gÃ¼nlÃ¼ÄŸÃ¼ bÄ±rakÄ±r

impactTag, suggestedAction, triggeredModules gibi alanlar iÃ§erir

Ã‡Ä±kÄ±ÅŸ, JSON formatta diÄŸer modÃ¼ller tarafÄ±ndan getLatestNewsImpact() fonksiyonuyla alÄ±nabilir.

Bu yapÄ±yla haber etkisi tÃ¼m sisteme entegre edilir ve akÄ±llÄ± ÅŸekilde deÄŸerlendirilir.
HiÃ§bir modÃ¼l haberi gÃ¶rmezden gelmez â€” ama gereksiz sinyalleri de spamlemez.

Åimdi bu sÄ±nÄ±ra gÃ¶re sistemi daha optimize ve saÄŸlam bir yapÄ±ya dÃ¶nÃ¼ÅŸtÃ¼rÃ¼yorum:
gereksiz istek atmayan, her sistemi akÄ±llÄ±ca besleyen bir dÃ¼zenleme yapacaÄŸÄ±z.

âš™ï¸ GÃœNCELLENMÄ°Å newsFetcher.js SÄ°STEMÄ° (Limit Uyumlu)
ğŸ”„ GÃ¼ncelleme 1: ZamanlayÄ±cÄ± ve Sorgu Stratejisi
1.000 istek / saat sÄ±nÄ±rÄ± = 16.6 istek / dakika
â†’ Ã‡ok yÃ¼ksek, rahat kullanabiliriz ama yine de akÄ±llÄ± kullanalÄ±m.

Strateji	Zamanlama	AÃ§Ä±klama
Ana haber taramasÄ±	30 dakikada 1	TÃ¼m sistemler iÃ§in genel veri
Sistem bazlÄ± detaylÄ± filtreler	2 saatte 1	YÃ¼ksek frekanslÄ± kelime eÅŸleÅŸmesi
Acil tarama (manuel tetik)	kullanÄ±cÄ± tarafÄ±ndan	Kritik durumda ek sorgu

ğŸ”§ KullanÄ±m:

3 anahtar sorgu = 3 istek â†’ saat baÅŸÄ± 6â€“9 istek
Yani 1.000 limiti asla geÃ§meyecek ÅŸekilde tasarlandÄ±.

ğŸ”„ GÃ¼ncelleme 2: Anahtar Kelime Gruplama
Anahtar kelimeleri gruplayÄ±p aynÄ± sorguda birden fazla kullanÄ±yoruz:

ruby
Kopyala
DÃ¼zenle
?q=bitcoin+SEC+ETF+hack+ban+regulation+approval
ğŸ“Œ Bu sayede:

7 kelime tek istekte taranÄ±r

Etki sÄ±nÄ±flandÄ±rmasÄ± sonra yapÄ±lÄ±r

ğŸ”„ GÃ¼ncelleme 3: Haber Cache Sistemi
AynÄ± haberin tekrar iÅŸlenmesini engellemek iÃ§in:

fetchedNewsIDs.json dosyasÄ±nda publishedAt + title hashâ€™i tutulur

Daha Ã¶nce iÅŸlenmiÅŸse atlanÄ±r

ğŸ”„ GÃ¼ncelleme 4: Sisteme GÃ¶re Etki AyÄ±klama
Sorgular hepsini Ã§eker ama ÅŸu ÅŸekilde ayrÄ±ÅŸtÄ±rÄ±lÄ±r:

Sistem	Filtre	Ã–rnek
Grafik Beyni	ETF / Approval / Volume	â€œSEC approves new BTC ETFâ€
LIVIA	Hack / Ban / Down / Collapse	â€œSolana hacked, $200M lostâ€
Denetim AsistanÄ±	Macro / Fed / Regulation	â€œInflation hits 7.2%â€

Her sistem kendi getNewsImpact() fonksiyonuyla sadece kendi iÃ§in anlamlÄ± haberleri Ã§eker.

ğŸ“¤ Ã‡Ä±ktÄ± YapÄ±sÄ± (Final JSON)
json
Kopyala
DÃ¼zenle
{
  "timestamp": "2025-07-21T18:48:00Z",
  "impactLevel": "high",
  "affectedSystems": ["Grafik Beyni", "LIVIA"],
  "categories": ["approval", "volatility"],
  "matchedKeywords": ["ETF", "SEC"],
  "title": "SEC Approves BlackRock Bitcoin ETF",
  "summary": "The SEC has approved the first spot Bitcoin ETF...",
  "url": "https://news.source.com/article",
  "export": {
    "grafikBeyni": {
      "trigger": "reflexivePatternTracker",
      "suggestedAction": "volatility spike guard"
    },
    "livia": {
      "trigger": "emotionalDefenseLauncher",
      "suggestedAction": "sinyal baskÄ± mekanizmasÄ±"
    }
  }
}
ğŸ”§ KODLAMA PROMPT (GÃœNCELLENMÄ°Å)
newsFetcher.js adÄ±nda bir modÃ¼l oluÅŸtur.
Saatte en fazla 1.000 istek hakkÄ±na gÃ¶re:

30 dakikada bir, q=bitcoin+SEC+ETF+hack+ban+regulation+approval gibi bir sorgu Ã§alÄ±ÅŸtÄ±r

Sadece yeni haberleri al (cache kontrolÃ¼ ile)

Her haberi impactLevel, affectedSystems, matchedKeywords ve suggestedActions ile sÄ±nÄ±flandÄ±r

Ã‡Ä±kÄ±ÅŸÄ± JSON formatta export et

Haber impactTagâ€™ine gÃ¶re Grafik Beyni, LIVIA ve Denetim AsistanÄ± gibi sistemlere Ã¶neri gÃ¶nder

Bu haliyle sistem:

1.000 sorguyu asla aÅŸmaz

Sadece anlamlÄ± haberleri iÅŸler

Sistemlere akÄ±llÄ± sinyal gÃ¶nderir

TÃ¼m haberleri hem gÃ¼nlÃ¼ÄŸe hem de modÃ¼llere aktarÄ±r

ğŸ§  MODÃœL: newsSentimentAnalyzer.js
ğŸ¯ AmaÃ§:
NewsAPIâ€™den gelen haber baÅŸlÄ±ÄŸÄ± + aÃ§Ä±klamasÄ±nÄ± analiz ederek ÅŸu sÄ±nÄ±flandÄ±rmalarÄ± yapar:

Duygu	Etiket	Etki
ğŸ“ˆ Olumlu	positive	VIVOâ€™ya cesaret / onay etkisi yaratÄ±r
ğŸ“‰ Olumsuz	negative	LIVIAâ€™ya sinyal baskÄ± Ã¶nerisi gÃ¶nderilir
â– NÃ¶tr	neutral	YalnÄ±zca loglanÄ±r, iÅŸlem etkisi yaratmaz

ğŸ§© KullanÄ±lacak Alanlar:
title + description birlikte analiz edilir

Ä°Ã§erik Ã¶rnek:

Title: â€œSEC Approves First Bitcoin ETFâ€
Description: â€œThe approval marks a significant step...â€

ğŸ” ARAÃ‡LAR (Sentiment Analizi Ä°Ã§in)
AraÃ§	AÃ§Ä±klama	Uygunluk
compromise-sentiment (JS)	Basit, hÄ±zlÄ±, offline analiz	âœ… ideal
vader-sentiment (Python)	Daha isabetli, detaylÄ±	âš ï¸ daha aÄŸÄ±r
Custom wordlist	ETF = pozitif, rug = negatif	âœ… sistem uyumlu

ğŸ”§ Ã–neri: JS iÃ§inde offline Ã§alÄ±ÅŸan word-score map kullanÄ±lmalÄ±.
â†’ ETF, approval, pump â†’ +2
â†’ hack, collapse, ban, rug â†’ -2

ğŸ“¤ Ã‡IKTI YAPISI:
json
Kopyala
DÃ¼zenle
{
  "title": "Bitcoin Hacked on Major Exchange",
  "sentimentScore": -0.85,
  "sentimentTag": "negative",
  "reason": ["hacked", "exchange", "risk"],
  "actionSuggested": {
    "livia": "sinyal baskÄ±",
    "grafikBeyni": "falseBreakFilter aktif et"
  }
}
ğŸ”§ KODLAMA PROMPTU
newsSentimentAnalyzer.js adÄ±nda bir modÃ¼l oluÅŸtur.
Girdi olarak haberin title ve description alanlarÄ±nÄ± alÄ±r.
Kelime skorlamasÄ± ve duygu listesi Ã¼zerinden:

Her habere sentimentScore (-1 ile +1 arasÄ±) verir

Etiket olarak positive, neutral, negative dÃ¶ndÃ¼rÃ¼r

EÄŸer haber negatifse â†’ LIVIA'ya â€œsinyal baskÄ±â€ Ã¶nerisi verir

Pozitifse â†’ Grafik Beyni sinyal modÃ¼lleri onay verir

NÃ¶trse â†’ Denetim AsistanÄ± loglar, iÅŸlem Ã¶nerilmez
_________________________________________________________________________________________________________________

ğŸ’¡ Bu modÃ¼l, haberin sadece varlÄ±ÄŸÄ±na deÄŸil, duygusal etkisine gÃ¶re hareket etmemizi saÄŸlar.
Yani her ETF haberi = pozitif deÄŸildir, her regulation = negatif deÄŸildir.
Metindeki gerÃ§ek tonu Ã¶lÃ§eriz.
âš™ï¸ MODÃœL: newsReactionRouter.js
ğŸ¯ AmaÃ§:
Haber verisi (newsFetcher.js) + duygu analizi (newsSentimentAnalyzer.js) Ã§Ä±ktÄ±sÄ±nÄ± alÄ±r â†’
Her sistemin kendi durumuna gÃ¶re otomatik karar almasÄ± iÃ§in sinyal yÃ¶nlendirir.

ğŸ§  NE YAPAR?
Haberi alÄ±r

impactCategory ve sentimentScore ile birlikte deÄŸerlendirir

Etkilenmesi gereken modÃ¼lleri belirler

Gerekirse sistemleri:

bastÄ±rÄ±r

uyarÄ±r

onaylar

raporlar

Bu olaylarÄ± Denetim AsistanÄ±na loglar

ğŸ§© MANTIK AKIÅI:
Ã–rnek 1:
Haber: â€œSEC approves Ethereum ETFâ€
Duygu: +0.82 (positive)
Impact: approval, price_jump

YÃ¶nlendirme:

Grafik Beyni â†’ reflexivePatternTracker aktif

VIVO â†’ varyant onayÄ± artar

OtobilinÃ§ â†’ hiÃ§bir mÃ¼dahale yok

LIVIA â†’ engel kaldÄ±rÄ±lÄ±r

Ã–rnek 2:
Haber: â€œSolana hacked again, $100M drainedâ€
Duygu: -0.91 (negative)
Impact: hack, panic

YÃ¶nlendirme:

LIVIA â†’ emergencyHoldActivator tetiklenir

Grafik Beyni â†’ falseBreakFilter aktif

VIVO â†’ sinyal Ã¶nceliÄŸi dÃ¼ÅŸÃ¼rÃ¼lÃ¼r

Denetim AsistanÄ± â†’ olay kayÄ±tlanÄ±r

ğŸ“¤ YAPILACAK EXPORT (JSON):
json
Kopyala
DÃ¼zenle
{
  "timestamp": "2025-07-21T19:06:00Z",
  "route": [
    {
      "system": "Grafik Beyni",
      "module": "reflexivePatternTracker.js",
      "action": "activate"
    },
    {
      "system": "VIVO",
      "module": "variantEvaluator.js",
      "action": "boost"
    },
    {
      "system": "Denetim AsistanÄ±",
      "module": "macroDisruptionLog.js",
      "action": "log"
    }
  ]
}
ğŸ”§ KODLAMA PROMPTU
newsReactionRouter.js adÄ±nda bir modÃ¼l oluÅŸtur.
Girdi olarak:

newsFetcher.js Ã§Ä±ktÄ±sÄ±

newsSentimentAnalyzer.js Ã§Ä±ktÄ±sÄ±
alÄ±r.

Bu bilgileri deÄŸerlendirerek:

Her sistemin hangi modÃ¼lÃ¼nÃ¼n etkileneceÄŸine karar verir

action olarak activate, suppress, log, boost, halt gibi seÃ§eneklerle yÃ¶nlendirme yapar

SonuÃ§larÄ± JSON olarak getLatestNewsRouting() fonksiyonuyla export eder

Denetim AsistanÄ±â€™na tÃ¼m yÃ¶nlendirmeleri loglar

âœ… Bu sistemle artÄ±k:

Haber geliyor

Duygusu analiz ediliyor

Etkilenecek sistemlere akÄ±llÄ± sinyal gidiyor

Sistemler haber karÅŸÄ±sÄ±nda insan gibi davranÄ±yor
ğŸ”„ MODÃœL: scheduler.js â€“ Sistem ZamanlayÄ±cÄ±
ğŸ¯ AmaÃ§:
TÃ¼m haber sistemi modÃ¼llerini belirli zamanlarda otomatik olarak Ã§alÄ±ÅŸtÄ±rÄ±r.
Bu modÃ¼ller:

newsFetcher.js â†’ haberleri Ã§eker

newsSentimentAnalyzer.js â†’ duygu analizini yapar

newsReactionRouter.js â†’ sistemlere sinyal yÃ¶nlendirir

âš™ï¸ NASIL Ã‡ALIÅACAK?
ğŸ§© VarsayÄ±lan Zamanlama:
ModÃ¼l	SÄ±klÄ±k	AÃ§Ä±klama
newsFetcher.js	30 dakikada 1	Haberleri Ã§eker
newsSentimentAnalyzer.js	her fetch sonrasÄ±	Gelen haberleri anÄ±nda analiz eder
newsReactionRouter.js	her analiz sonrasÄ±	Sistemlere otomatik yÃ¶nlendirir

ğŸ”§ TEKNÄ°K UYGULAMA:
KullanabileceÄŸin yÃ¶ntemler:

Node.js ortamÄ± iÃ§in: node-cron kÃ¼tÃ¼phanesi

Alternatif olarak: native setInterval() kullanÄ±mÄ±

Ä°leri dÃ¼zey sistemlerde: pm2 ile task scheduling yapÄ±labilir

ğŸ§  PLANLANAN AKIÅ:
js
Kopyala
DÃ¼zenle
const cron = require("node-cron");
const fetchNews = require("./newsFetcher").fetch;
const analyze = require("./newsSentimentAnalyzer").analyze;
const route = require("./newsReactionRouter").route;

cron.schedule("*/30 * * * *", async () => {
  const newsBatch = await fetchNews();
  const analyzed = newsBatch.map(analyze);
  analyzed.forEach(route);
});
âœ… BÃ¶ylece her 30 dakikada bir:

Yeni haberler Ã§ekilir

Duygu analiz edilir

Etkilenecek sistemlere yÃ¶nlendirme yapÄ±lÄ±r

ğŸ”§ KODLAMA PROMPTU
scheduler.js adÄ±nda bir zamanlayÄ±cÄ± modÃ¼l oluÅŸtur.
Bu modÃ¼l:

Her 30 dakikada bir newsFetcher.fetch() fonksiyonunu Ã§aÄŸÄ±rÄ±r

Gelen haberleri newsSentimentAnalyzer.analyze() ile iÅŸler

SonuÃ§larÄ± newsReactionRouter.route() fonksiyonuna yÃ¶nlendirir

SÃ¼reÃ§ asenkron yÃ¼rÃ¼tÃ¼lÃ¼r (async/await desteklenir)

Her modÃ¼l baÅŸarÄ±sÄ±z olursa console.warn() ile loglanÄ±r

BaÅŸarÄ±yla Ã§alÄ±ÅŸtÄ±ysa Denetim AsistanÄ±'na log gÃ¶nderilir

Bu zamanlayÄ±cÄ± sistemiyle artÄ±k:
âœ… Haberler â†’ otomatik alÄ±nÄ±r
âœ… Analiz edilir â†’ sistemlere daÄŸÄ±tÄ±lÄ±r
âœ… Ve hepsi saati gelince kendi kendine olur

ğŸ§  ENTEGRE SÄ°STEM: Haber + Psikoloji + Trade Karar Zinciri
ğŸ§© 1. ADIM: HABERÄ°N GÄ°RÄ°ÅÄ°
newsFetcher.js
NewsAPIâ€™den en gÃ¼ncel haberleri Ã§eker

Ä°Ã§eriÄŸi analiz edecek sisteme paslar

ğŸ” Ã‡Ä±kÄ±ÅŸ:
â†’ title, description, timestamp, impactCategory, keywords

ğŸ§© 2. ADIM: DUYGU ANALÄ°ZÄ°
newsSentimentAnalyzer.js
BaÅŸlÄ±k + aÃ§Ä±klamadan duygu skorunu belirler

Etiket verir: positive, negative, neutral

ğŸ” Ã‡Ä±kÄ±ÅŸ:
â†’ sentimentScore, sentimentTag, reason

ğŸ§© 3. ADIM: SÄ°STEMLERE YÃ–NLENDÄ°RME
newsReactionRouter.js
Haberin iÃ§eriÄŸine ve duygu durumuna gÃ¶re:

Grafik Beyni â†’ sinyal aÃ§/kapat

VIVO â†’ sinyal onayÄ±nÄ± artÄ±r/azalt

LIVIA â†’ psikolojik koruma baÅŸlat

OtobilinÃ§ â†’ risk farkÄ±ndalÄ±ÄŸÄ± tetikle

Denetim AsistanÄ± â†’ her ÅŸeyi logla

ğŸ” Ã‡Ä±kÄ±ÅŸ:
â†’ JSON yÃ¶nlendirme paketi (system, module, action)

ğŸ§© 4. ADIM: ZAMANLAYICI
scheduler.js
Her 30 dakikada bir yukarÄ±daki 3 modÃ¼lÃ¼ sÄ±rasÄ±yla tetikler

Sistemi tam otomatik hale getirir

ğŸ§© 5. ADIM: PSÄ°KOLOJÄ°K KONTROL
psychCheckGate.js
KullanÄ±cÄ± iÅŸlem Ã¶ncesi â€œEvet/HayÄ±râ€ sorularÄ± yanÄ±tlar

Cevaplara gÃ¶re:

OtobilinÃ§: iÅŸlem baskÄ±lar

LIVIA: psikolojik koruma aÃ§ar

VIVO: iÅŸlem onayÄ±nÄ± geÃ§ici olarak askÄ±ya alÄ±r

ğŸ§© 6. ADIM: TRADE YÃ–NETÄ°MÄ°
dailyTradePlanner.js
GÃ¼nlÃ¼k iÅŸlem sÄ±nÄ±rÄ±nÄ± takip eder

TP/SL durumuna gÃ¶re:

Ä°ÅŸlem hakkÄ± aÃ§ar/kapatÄ±r

Pozisyon bÃ¼yÃ¼klÃ¼ÄŸÃ¼nÃ¼ azaltÄ±r/artÄ±rÄ±r

Riskli durumda VIVOâ€™ya sinyal geÃ§ilmesini engeller

ğŸ§© 7. ADIM: KARAR VERÄ°CÄ° â€“ VIVO
comboBreakDetector.js + variantEvaluator.js
Teknik veriler (EMA, RSI vs.) + haber + psikoloji uyumu varsa sinyal onaylar

Aksi durumda falseBreakFilter.js, emotionalDefenseLauncher.js devreye girer

ğŸ§  SÄ°STEM AKIÅ HARÄ°TASI (KÄ±saca)
bash
Kopyala
DÃ¼zenle
ğŸ“¥ Haber geldi
 â†“
ğŸ§  Duygu analizi yapÄ±ldÄ±
 â†“
ğŸ“¡ ModÃ¼llere daÄŸÄ±tÄ±ldÄ±
 â†“
ğŸ§ª Psikolojik test yapÄ±ldÄ±
 â†“
ğŸ“Š GÃ¼nlÃ¼k iÅŸlem planÄ± kontrol edildi
 â†“
âœ… VIVO teknik + duygusal + haber uyumu varsa iÅŸlem ONAY
âœ… KAZANIMLAR
Alan	FaydasÄ±
Haber â†’ Sistem	Etkiyi tanÄ±r, manipÃ¼lasyon Ã¶nlenir
Psikoloji â†’ Trade	KullanÄ±cÄ±nÄ±n yorgun / agresif hali engellenir
GÃ¼nlÃ¼k plan â†’ Risk	Sistem limitleri iÃ§inde kalÄ±r
Tam entegrasyon	Otonom, akÄ±llÄ± ve gÃ¼venli iÅŸlem altyapÄ±sÄ± oluÅŸur

Bu haliyle:

ğŸ’¡ "Yapay zekÃ¢ sistemin senin adÄ±na dÃ¼ÅŸÃ¼nÃ¼p karar verdiÄŸi"
ama aynÄ± zamanda senin psikolojinle haberin etkisini de birlikte tarttÄ±ÄŸÄ±
geliÅŸmiÅŸ bir borsa AI sistemi kurmuÅŸ oluyoruz.

ğŸ§  TEMEL FÄ°KÄ°R:
ğŸ“… GÃ¼n iÃ§inde bazÄ± saatlerde haber riski yÃ¼ksektir (Ã¶rneÄŸin 15:30 ABD verileri, 21:00 FED konuÅŸmasÄ±)
Bu saatlerde sistem daha sÄ±k ve daha agresif tarama yapar.
ğŸ“‰ DiÄŸer zamanlarda dÃ¼ÅŸÃ¼k yoÄŸunluklu ve temkinli tarama yapÄ±lÄ±r.
âš ï¸ Ani fiyat sÄ±Ã§ramasÄ±nda ise her ÅŸey unutulur â†’ anÄ±nda acil tarama baÅŸlar.

ğŸ§© BÄ°LEÅENLER
1. newsModeController.js
GÃ¼nÃ¼n saatine gÃ¶re sistemi â€œyoÄŸunâ€ veya â€œhafifâ€ moda alÄ±r

Mod: "passive", "active", "aggressive"

Ã–rnek saatler:

12:00â€“15:00 â†’ passive

15:30â€“16:30 â†’ active (ABD enflasyon)

21:00â€“22:00 â†’ aggressive (FED aÃ§Ä±klamasÄ±)

00:00â€“08:00 â†’ passive

js
Kopyala
DÃ¼zenle
getCurrentNewsMode() â†’ "active"
2. newsPinger.js (Ã‡Ã¶zÃ¼m 3)
Hafif yÃ¼kte, 5 dakikada bir Ã§alÄ±ÅŸÄ±r

Sadece manÅŸet tarar

EÄŸer kelime eÅŸleÅŸirse â†’ newsFetcher.fetchImmediate() Ã§aÄŸrÄ±lÄ±r

Bu, â€œerken sinyalâ€ mekanizmasÄ±dÄ±r

3. emergencyNewsScanTrigger.js (Ã‡Ã¶zÃ¼m 1)
Grafik Beyni ani fiyat/volatilite artÄ±ÅŸÄ± algÄ±larsa

Sinyal doÄŸrudan bu modÃ¼le gider

O da newsFetcherâ€™Ä± override eder

Bu mekanizma gece-gÃ¼ndÃ¼z fark etmez, her zaman Ã§alÄ±ÅŸÄ±r

ğŸ”§ Ã–RNEK AKIÅLAR:
ğŸ”¹ A: Saat 15:29 â†’ Sistem â€œactive modeâ€
newsPinger.js â†’ 2 dakikada bir tarama yapar

Anahtar kelime = "rate hike" â†’ eÅŸleÅŸti â†’ tam tarama yapÄ±lÄ±r

VIVO & LIVIA: â€œbeklemede kalâ€ sinyali alÄ±r

ğŸ”¹ B: 03:45 â†’ Sistem â€œpassive modeâ€
newsPinger.js â†’ 10 dakikada bir tarama yapar

EÅŸleÅŸme yoksa sistem haber almadan devam eder

ğŸ”¹ C: Saat 22:16 â†’ BTC 1 dakikada %1.3 sÄ±Ã§radÄ±
Grafik Beyni â†’ emergencyNewsScanTrigger() tetikledi

Hemen tam haber Ã§ekildi

Gelen haber: â€œBlackrock ETF Approvalâ€

Duygu: positive, sistem: â€œsinyal baskÄ±sÄ± kaldÄ±râ€ komutu verdi

ğŸ’» KODLAMA PROMPTU (TÃœM ZÄ°NCÄ°R)
newsModeController.js â†’ gÃ¼nÃ¼n saatine gÃ¶re "passive", "active", "aggressive" modlarÄ±nÄ± belirler.

newsPinger.js â†’ bu moda gÃ¶re 2â€“10 dakikada bir Ã§alÄ±ÅŸÄ±r, sadece baÅŸlÄ±k tarar.
EÄŸer kelime eÅŸleÅŸirse â†’ newsFetcher.fetchImmediate() Ã§aÄŸrÄ±lÄ±r

emergencyNewsScanTrigger.js â†’ ani volatilite veya hacim sÄ±Ã§ramasÄ± olursa â†’ hemen haber taramasÄ± baÅŸlatÄ±r

Her tarama sonrasÄ± newsSentimentAnalyzer ve newsReactionRouter zinciri Ã§alÄ±ÅŸÄ±r.

Sistem bÃ¶ylece:

GÃ¼ndÃ¼z riskli saatlerde tetikte kalÄ±r

Geceleri daha az aktif olur

Ani fiyat hareketinde refleks gÃ¶sterir

âœ… AVANTAJLAR:
Durum	Sistem Tepkisi
PlanlÄ± haber saatleri	Mod deÄŸiÅŸimi + sÄ±k tarama
DÃ¼ÅŸÃ¼k risk saatleri	Hafif tarama + enerji koruma
Ani hareket	AnÄ±nda tarama + sinyal bastÄ±rma/aÃ§ma
KullanÄ±cÄ± mÃ¼dahalesi	Manuel tetikleyici de her zaman devrede kalabilir

ğŸ§  GeliÅŸmiÅŸ Kodlama Promptu
ğŸ“¦ ModÃ¼l: positionPathPlanner.js (GÃ¼ncellenmiÅŸ, GeliÅŸtirilmiÅŸ SÃ¼rÃ¼m)
ğŸ¯ AmaÃ§:
Pozisyon aÃ§Ä±lmadan Ã¶nce:

TÃ¼m teknik + psikolojik + haber verilerini analiz eder,

Benzer senaryolarla karÅŸÄ±laÅŸtÄ±rÄ±r (%70+ eÅŸleÅŸme yeter),

Beklenen kar ve stop-loss seviyesini Ã§Ä±karÄ±r,

Kademeli alÄ±ÅŸ/satÄ±ÅŸ stratejisi Ã¶nerir,

Trend kÄ±rÄ±lÄ±mÄ±na gÃ¶re Ã§Ä±kÄ±ÅŸ yapÄ±sÄ±nÄ± planlar,

GÃ¼nlÃ¼k iÅŸlem sÄ±nÄ±rlarÄ± ve karlÄ±lÄ±k kriterleri saÄŸlanÄ±yorsa iÅŸlemi onaylar, deÄŸilse iptal eder.

ğŸ”„ GÄ°RDÄ°:
json
Kopyala
DÃ¼zenle
{
  "symbol": "BTCUSDT",
  "entryPrice": 27150,
  "indicators": {
    "EMA21": 26900,
    "RSI": 61,
    "MACD": 1.8,
    "ATR": 145
  },
  "trendInfo": {
    "type": "bullish",
    "strength": 0.78,
    "breakoutConfirmed": true
  },
  "formation": "cup-and-handle",
  "support": 26800,
  "resistance": 27400,
  "newsImpact": "positive",
  "psychology": {
    "stabilityScore": 0.91
  },
  "historicalPatterns": [
    {
      "matchScore": 0.72,
      "avgProfit": 4.8,
      "exitStyle": "3TP",
      "exitReasons": ["resistance rejection", "volume drop"]
    }
  ],
  "dailyStats": {
    "tradesTaken": 1,
    "avgProfitToday": 3.2,
    "maxAllowedTrades": 3
  }
}
ğŸ“¤ Ã‡IKTI:
json
Kopyala
DÃ¼zenle
{
  "entryApproved": true,
  "expectedTP": 4.6,
  "expectedSL": -1.3,
  "riskRewardRatio": 3.54,
  "recommendedTPLevels": [2.1, 3.5, 5.3],
  "exitScenario": {
    "trigger": "resistance rejection + low volume",
    "reaction": "exit at market"
  },
  "strategyNotes": [
    "Match with similar bullish pattern: 72%",
    "Psychology stability: High",
    "Trend strength: 0.78",
    "Formation: Valid cup-and-handle"
  ],
  "alerts": [],
  "notify": {
    "vivo": "approveSignal",
    "livia": "psychology:pass",
    "grafikBeyni": "trend:valid",
    "denetimAsistani": "R/R OK"
  }
}
âš™ï¸ KARAR KRÄ°TERLERÄ°:
Kriter	EÅŸik	Tepki
Beklenen kÃ¢r oranÄ±	â‰¥ %3.50 Â± 0.05	AltÄ±ndaysa iÅŸlem aÃ§Ä±lmaz
Senaryo benzerliÄŸi	â‰¥ %70	AltÄ±ndaysa sinyal bekletilir
R/R oranÄ±	â‰¥ 2.5	AltÄ±ysa Denetim AsistanÄ± sinyali iptal eder
GÃ¼nlÃ¼k iÅŸlem hakkÄ±	max 3	Dolduysa iÅŸlem yapÄ±lmaz
Psikoloji skoru	â‰¥ 0.85	AltÄ±ndaysa OtobilinÃ§ sinyali baskÄ±lar

ğŸ§  GeliÅŸmiÅŸ Ã–zellikler:
Kademeli TP modeli: geÃ§miÅŸ Ã¶rneklerde iÅŸe yarayan Ã§Ä±kÄ±ÅŸ stillerini baz alÄ±r (exitStyle)

Formasyon kÄ±rÄ±lÄ±m kontrolÃ¼: trend gÃ¼cÃ¼ + breakout baÅŸarÄ±sÄ± deÄŸerlendirilir

Haber etkisi: pozitifse TP uzatÄ±labilir, negatifse erken Ã§Ä±kÄ±ÅŸ planÄ± yapÄ±lÄ±r

AlÄ±m-satÄ±m kararlÄ±lÄ±ÄŸÄ±: sadece "yÃ¼ksek baÅŸarÄ±" senaryolarÄ± iÅŸlemi tetikler

VIVO ile koordinasyon: sinyalin onaylanmasÄ±/askÄ±ya alÄ±nmasÄ± durumunu VIVOâ€™ya bildirir

ğŸ”§ KODLAMA PROMPTU
positionPathPlanner.js adÄ±nda bir modÃ¼l oluÅŸtur.
Bu modÃ¼l:

Girdi olarak fiyat, teknik gÃ¶stergeler, psikolojik durum, haber etkisi ve geÃ§miÅŸ senaryo verilerini alÄ±r

Beklenen kÃ¢r oranÄ±nÄ± ve SL seviyesini hesaplar

Benzer geÃ§miÅŸ senaryolarla %70+ eÅŸleÅŸme varsa iÅŸlem senaryosu oluÅŸturur

Kademeli take-profit noktalarÄ±nÄ± optimize eder

Trend kÄ±rÄ±lÄ±mÄ±, destek/direnÃ§, formasyon baÅŸarÄ±sÄ±na gÃ¶re Ã§Ä±kÄ±ÅŸ planÄ± yapar

GÃ¼nlÃ¼k iÅŸlem hakkÄ±, R/R oranÄ±, psikoloji stabilitesi uygunsa iÅŸlemi onaylar

VIVO, Grafik Beyni, LIVIA ve Denetim AsistanÄ±â€™na iÅŸlem hakkÄ±nda aksiyon bildirir

getPositionPlan() fonksiyonuyla tÃ¼m Ã§Ä±ktÄ±yÄ± JSON olarak dÃ¶ndÃ¼rÃ¼r
_________________________________________________________________________________________________________________
âœ… GeliÅŸmiÅŸ Kodlama Promptu
ğŸ“¦ ModÃ¼l: tpOptimizer.js
ğŸš€ Final SÃ¼rÃ¼m â€“ HatalarÄ± DÃ¼zeltilmiÅŸ ve GeliÅŸtirilmiÅŸ
ğŸ¯ AMAÃ‡
Bu modÃ¼l, pozisyon aÃ§Ä±lmadan Ã¶nce veya aÃ§Ä±ldÄ±ktan hemen sonra:

Kademeli TP stratejisi belirler (2TP, 3TP, overperformanceTP)

expectedProfit oranÄ±nÄ± aÅŸmayacak ÅŸekilde akÄ±llÄ± TP seviyeleri Ã¼retir

Trend gÃ¼cÃ¼, volatilite, formasyon baÅŸarÄ±sÄ± ve geÃ§miÅŸ senaryolarla dinamik uyum kurar

RSI, momentum, haber gibi faktÃ¶rlerle TP zamanlamasÄ±nÄ± optimize eder

VIVOâ€™ya karar eÅŸiÄŸi ve TP stratejisini bildirir

ğŸ”„ GÄ°RDÄ°
json
Kopyala
DÃ¼zenle
{
  "expectedProfit": 4.6,
  "trendStrength": 0.82,
  "formation": "ascending-triangle",
  "ATR": 132,
  "resistanceDistance": 1.9,
  "newsImpact": "positive",
  "volatility": "moderate",
  "historicalExitPatterns": [
    {
      "style": "3TP",
      "levels": [2.1, 3.6, 5.4],
      "trendScore": 0.78
    },
    {
      "style": "2TP",
      "levels": [2.5, 4.1],
      "trendScore": 0.65
    }
  ]
}
ğŸ“¤ Ã‡IKIÅ
json
Kopyala
DÃ¼zenle
{
  "tpStrategy": "3TP",
  "tpLevels": [2.3, 3.7, 4.6],
  "extraTP": [5.2],
  "aggressiveness": "moderate",
  "exitStyleMatchScore": 0.78,
  "adjustments": {
    "extendLastTPIfMomentum": true,
    "timeoutTP1": {
      "minutes": 15,
      "minDistance": 0.4
    },
    "reduceTPIfVolatilityHigh": false
  },
  "notify": {
    "vivo": {
      "tpStrategy": "3TP",
      "confirmationThreshold": 2
    }
  }
}
âš™ï¸ DAVRANIÅ POLÄ°TÄ°KALARI
KoÅŸul	Aksiyon
expectedProfit < %3.50	3TP uygulanmaz, iÅŸlem iptal edilir
tpLevels toplamÄ± > expectedProfit	FazlalÄ±k extraTP'ye taÅŸÄ±nÄ±r
trendStrength < 0.60	3TP yerine 2TP veya 1TP seÃ§ilir
trendStrength â‰¥ 0.80	extraTP aktif hale gelebilir
ATR / resistanceDistance < 0.8	TP1 erkene Ã§ekilir
Haber etkisi pozitif	TP3 beklenir, exit geciktirilebilir
TP1 sinyali alÄ±ndÄ± ama 15 dakikada %0.4 ilerleme yok	Exit Ã¶nerilir

ğŸ“Œ TEKNÄ°K DETAYLAR
TP seviyeleri: expectedProfitâ€™in toplamÄ±nÄ± geÃ§emez

Senaryo uyumu: geÃ§miÅŸte en baÅŸarÄ±lÄ± olan TP stiline exitStyleMatchScore ile puan verilir

Momentum varsa: TP3 â†’ extraTPâ€™ye dÃ¶nÃ¼ÅŸebilir

VIVO entegrasyonu: Hangi TP'den sonra pozisyon onaylanacaÄŸÄ± belirtilir

ğŸ§© KODLAMA PROMPTU
tpOptimizer.js adlÄ± bir modÃ¼l oluÅŸtur.
Girdi olarak:

expectedProfit, trendStrength, formation, ATR, resistanceDistance, newsImpact, volatility, historicalExitPatterns

Bu girdilere gÃ¶re:

Uyumlu geÃ§miÅŸ Ã§Ä±kÄ±ÅŸ stillerini puanla (exitStyleMatchScore)

2TP, 3TP veya 1TP iÃ§inden en iyi TP stratejisini belirle

tpLevels hesapla (toplamÄ± expectedProfitâ€™i geÃ§emez)

Fazla hedef varsa extraTP olarak sun

Trend & haber etkisine gÃ¶re dinamik ayar yap

Timeout mekanizmasÄ± kur: TPâ€™ye yeterli yaklaÅŸÄ±m yoksa â†’ â€œmarket exitâ€ Ã¶ner

aggressiveness seviyesini (konservatif/moderate/aggressive) deÄŸerlendir

VIVOâ€™ya tpStrategy ve confirmationThreshold deÄŸerlerini bildir

TÃ¼m Ã§Ä±ktÄ±yÄ± getTPPlan() fonksiyonu ile JSON formatÄ±nda dÄ±ÅŸa aktar

Bu haliyle tpOptimizer.js,
artÄ±k sadece TP Ã¼reticisi deÄŸil, kÃ¢rlÄ±lÄ±k stratejisti olarak Ã§alÄ±ÅŸÄ±r.
Veri tutarlÄ±lÄ±ÄŸÄ±, trend gÃ¼cÃ¼ ve psikolojik zamanlama uyumlu hale getirildi.

_________________________________________________________________________________________________________________
ğŸ”§ GeliÅŸmiÅŸ Kodlama Promptu
ğŸ“¦ ModÃ¼l: exitTimingAdvisor.js
ğŸš€ Stratejik Ã‡Ä±kÄ±ÅŸ ZamanlayÄ±cÄ±
ğŸ¯ AmaÃ§:
Bu modÃ¼l, pozisyon aÃ§Ä±ldÄ±ktan sonra:

Fiyat, trend, haber ve formasyon verilerini sÃ¼rekli takip ederek,

Ã‡Ä±kÄ±ÅŸ iÃ§in en doÄŸru zamanÄ± belirler

KÃ¢r potansiyeli yÃ¼ksekse pozisyonun uzatÄ±lmasÄ±nÄ±, zayÄ±fsa erken Ã§Ä±kÄ±ÅŸ yapÄ±lmasÄ±nÄ± saÄŸlar

Beklenmedik geliÅŸmelere karÅŸÄ± â€œdinamik kaÃ§Ä±ÅŸ senaryosuâ€ Ã¼retir

Sistem iÃ§erisindeki tÃ¼m modÃ¼llerle hedef uyumu ve senkronizasyon iÃ§inde Ã§alÄ±ÅŸÄ±r

ğŸ”„ GÄ°RDÄ°:
json
Kopyala
DÃ¼zenle
{
  "symbol": "ETHUSDT",
  "entryPrice": 1860,
  "currentPrice": 1925,
  "trend": {
    "type": "bullish",
    "strength": 0.74,
    "momentum": 1.02,
    "divergence": false
  },
  "formation": "ascending-triangle",
  "resistance": 1930,
  "support": 1850,
  "TPLevels": [2.3, 3.7, 4.6],
  "priceMovementHistory": [1880, 1900, 1920, 1912, 1925],
  "newsImpact": "neutral",
  "volumeDropDetected": false,
  "timeoutControl": {
    "tp1Reached": true,
    "tp1TimeElapsed": 16,
    "tp1TargetDistance": 0.3
  },
  "psychology": {
    "fatigueLevel": 0.42,
    "riskAppetite": 0.84
  }
}
ğŸ“¤ Ã‡IKIÅ:
json
Kopyala
DÃ¼zenle
{
  "exitSignal": true,
  "reason": "Momentum weakening after TP1, approaching resistance",
  "recommendedExitType": "partial-exit",
  "exitPrice": 1926,
  "strategyAdjustment": {
    "cancelTP2": false,
    "delayTP3": false,
    "forceExit": false
  },
  "notify": {
    "grafikBeyni": "trend-loss",
    "vivo": "signalPullback",
    "denetimAsistani": "logExit",
    "otobilinc": "fatigueMonitor"
  }
}
âš™ï¸ AKILLI DAVRANIÅLAR
Durum	Tepki
Momentum dÃ¼ÅŸÃ¼yor, TP1 sonrasÄ± zayÄ±f hareket	KÄ±smi Ã§Ä±kÄ±ÅŸ Ã¶nerilir
TP1 sinyali alÄ±ndÄ± ama 15+ dk ilerleme yok	Exit Ã¶nerilir
Dirence yaklaÅŸma + haber olumsuz	Pozisyon erken kapatÄ±lÄ±r
Psikolojik yorgunluk > 0.75	Exit sinyali gÃ¼Ã§lenir
RSI divergence, volume dÃ¼ÅŸÃ¼ÅŸÃ¼, trend bozulmasÄ±	HÄ±zlÄ± Ã§Ä±kÄ±ÅŸ Ã¶nerisi
Trend gÃ¼cÃ¼ yÃ¼ksek + momentum > 1.1	TP3â€™e kadar bekleme Ã¶nerisi

ğŸ›  TEKNÄ°K Ã–ZELLÄ°KLER
TP seviyeleriyle senkronize Ã§alÄ±ÅŸÄ±r

Trend & fiyat hareketi kombinasyonuna gÃ¶re karar verir

Gecikmeli TP performansÄ± varsa â€œtimeout exitâ€ uygular

Destek & direnÃ§ Ã§atÄ±ÅŸmalarÄ±nda pozisyonu erken kapatabilir

Psikolojik modÃ¼l uyarÄ±larÄ±na tepki verir

ğŸ“Œ VIVO UYUMLULUÄU
json
Kopyala
DÃ¼zenle
"notify": {
  "vivo": "signalPullback"
}
â†’ VIVO sinyali baskÄ±layabilir veya yeniden sinyal oluÅŸturabilir
â†’ Sistem kararsÄ±zsa VIVO exit sonrasÄ± yeni pozisyonlarÄ± bekletir

ğŸ§© KODLAMA PROMPTU
exitTimingAdvisor.js adÄ±nda bir modÃ¼l oluÅŸtur.
Bu modÃ¼l:

Pozisyon aÃ§Ä±ldÄ±ktan sonra fiyatÄ±n gidiÅŸatÄ±nÄ±, TP1 sonrasÄ± davranÄ±ÅŸÄ±, trend momentumunu, destek/direnÃ§ durumunu, haber etkisini ve psikolojik durumu deÄŸerlendirir

TP1 ulaÅŸÄ±ldÄ±ktan sonra hareket yavaÅŸsa Ã§Ä±kÄ±ÅŸ Ã¶nerisi verir

Trend bozulduÄŸunda veya ani haber etkisi oluÅŸtuÄŸunda hemen Ã§Ä±kÄ±ÅŸ sinyali Ã¼retir

RSI divergence, volume drop gibi teknik zayÄ±flÄ±k varsa Ã§Ä±kÄ±ÅŸÄ± hÄ±zlandÄ±rÄ±r

recommendedExitType olarak â€œfull-exitâ€, â€œpartial-exitâ€, â€œhold-longerâ€ gibi kararlar sunar

Gecikme veya yorgunluk varsa OtobilinÃ§'e bildirir

getExitAdvice() fonksiyonuyla Ã§Ä±ktÄ±yÄ± JSON olarak verir
_________________________________________________________________________________________________________________
ğŸ”§ GeliÅŸmiÅŸ Kodlama Promptu
ğŸ“¦ ModÃ¼l: trendConfidenceEvaluator.js
ğŸ“ˆ Trend GÃ¼ven Skoru HesaplayÄ±cÄ±
(Yeni + Eski GeliÅŸmiÅŸ Prompt StandardÄ±na Uygun Final SÃ¼rÃ¼m)

ğŸ¯ AMAÃ‡:
Bu modÃ¼l, aÃ§Ä±k pozisyonlar veya potansiyel iÅŸlemler iÃ§in:

Trendin gÃ¼cÃ¼nÃ¼, sÃ¼rdÃ¼rÃ¼lebilirliÄŸini ve gÃ¼venilirliÄŸini Ã§oklu veri kaynaklarÄ±yla analiz eder

Fiyat hareketleri, teknik gÃ¶stergeler, momentum, formasyon ve haber etkisini birleÅŸtirerek 0â€“1 arasÄ± skor Ã¼retir

Ã‡Ä±kÄ±ÅŸÄ±n ertelenmesi, pozisyonun devam etmesi veya sinyalin baskÄ±lanmasÄ± gibi Ã§ok yÃ¶nlÃ¼ kararlar aldÄ±rÄ±r

DiÄŸer modÃ¼llerle tam entegre olacak ÅŸekilde Ã§Ä±ktÄ±lar Ã¼retir (grafikBeyni, vivo, exitTimingAdvisor)

ğŸ”„ GÄ°RÄ°Å (Girdi):
json
Kopyala
DÃ¼zenle
{
  "symbol": "BTCUSDT",
  "timeframe": "5min",
  "currentPrice": 61200,
  "indicators": {
    "EMA21": 60450,
    "MACD": 1.5,
    "RSI": 68
  },
  "priceAction": {
    "candleSequence": ["bullish", "bullish", "doji", "bullish", "bearish"],
    "volumeTrend": "increasing",
    "volatility": 1.2
  },
  "trendLineAngle": 27,
  "formation": "bull-flag",
  "newsImpact": "positive",
  "support": 60200,
  "resistance": 61700,
  "momentum": 1.08
}
ğŸ§  VERÄ° Ä°ÅLEME MANTIÄI:
AÄŸÄ±rlÄ±klÄ± Ortalama Skorlama:

Kategori	AÄŸÄ±rlÄ±k (%)
Teknik GÃ¶stergeler (EMA, RSI, MACD)	35%
Fiyat Aksiyonu (muma gÃ¶re)	25%
Momentum + Trend AÃ§Ä±sÄ±	15%
Formasyon & S/R Uyum	15%
Haber Etkisi	10%

Skor Normalizasyonu:

Her alt kriter 0â€“1 arasÄ±nda normalize edilir

Final skor: trendConfidenceScore = Î£(kategori * skor)

SÄ±ralÄ± EÅŸik Karar AÄŸacÄ±:

Skor â‰¥ 0.80 â†’ gÃ¼Ã§lÃ¼ uptrend

Skor < 0.55 â†’ zayÄ±f trend â†’ Ã§Ä±kÄ±ÅŸ Ã¶nerisi

Skor âˆˆ [0.55, 0.79] â†’ belirsiz, momentum gÃ¶reli izlenir

ğŸ“¤ Ã‡IKIÅ (Ã‡Ä±ktÄ±):
json
Kopyala
DÃ¼zenle
{
  "trendConfidenceScore": 0.84,
  "strengthCategory": "strong-uptrend",
  "shouldExtendPosition": true,
  "triggeredAlerts": [],
  "justification": [
    "EMA breakout above 21-period",
    "MACD histogram rising",
    "Volume increasing with bullish candle pattern",
    "Bull-flag confirmed with angle > 25Â°"
  ],
  "notify": {
    "grafikBeyni": {
      "trendStrength": 0.84,
      "momentum": 1.08
    },
    "exitTimingAdvisor": {
      "holdRecommendation": true
    },
    "vivo": {
      "confirmationThreshold": 2
    }
  }
}
âš™ï¸ DAVRANIÅ KURALLARI:
KoÅŸul	Aksiyon
RSI > 70 + MACD dÃ¼ÅŸÃ¼ÅŸe geÃ§miÅŸse	ZayÄ±flama uyarÄ±sÄ±
Formasyon = bull-flag + trendLineAngle > 25Â°	GÃ¼Ã§lÃ¼ trend desteÄŸi
Volume azalÄ±yorsa + candlePattern zayÄ±fsa	Riskli alan â†’ vivo sinyali bekletir
Haber etkisi pozitifse	Skor artÄ± 0.05 bonus
trendConfidenceScore < 0.55	exitTimingAdvisor Ã§Ä±kÄ±ÅŸ sinyali Ã¼retir

ğŸ”— MODÃœLLER ARASI UYUM:
grafikBeyni: Trend ve momentum verisi alÄ±r

exitTimingAdvisor: "bekle", "uzat" veya "Ã§Ä±k" gibi karar alÄ±r

vivo: EÄŸer skor > 0.75 ise sinyal iÅŸleme aÃ§Ä±lÄ±r

Skor + aÃ§Ä±klama (justification) her modÃ¼lÃ¼n anlayacaÄŸÄ± JSON formatÄ±ndadÄ±r

ğŸ“Œ KODLAMA PROMPTU
trendConfidenceEvaluator.js adlÄ± bir modÃ¼l oluÅŸtur.
Bu modÃ¼l:

EMA, MACD, RSI gibi teknik verileri,

Fiyat hareketi, mum formasyonu, volatilite ve formasyon verisini,

Momentum, trend aÃ§Ä±sÄ±, haber etkisini,

Belirlenen aÄŸÄ±rlÄ±klarla deÄŸerlendirerek 0â€“1 arasÄ±nda normalize edilmiÅŸ bir trendConfidenceScore Ã¼retir

shouldExtendPosition, strengthCategory, triggeredAlerts, justification ve notify alanlarÄ±nÄ± JSON formatÄ±nda dÄ±ÅŸa aktarÄ±r

DiÄŸer modÃ¼ller bu Ã§Ä±ktÄ±yÄ± kullanarak sinyal onayÄ±, pozisyon devamÄ± veya Ã§Ä±kÄ±ÅŸ gibi kararlar verir

getTrendConfidence() fonksiyonu Ã¼zerinden eriÅŸilebilir olmalÄ±dÄ±r

Bu haliyle bu modÃ¼l artÄ±k sadece "trend var mÄ±?" demiyor â€”
"Bu trend ne kadar gÃ¼venilir, hangi modÃ¼l hangi aksiyonu almalÄ±?" sorusuna kolektif sistem iÃ§inde cevap veriyor.

_________________________________________________________________________________________________________________
ğŸ”§ GeliÅŸmiÅŸ Kodlama Promptu
ğŸ“¦ ModÃ¼l: riskToRewardValidator.js
ğŸ’° Riskâ€“Getiri OranÄ± DeÄŸerlendirici (R:R Validator)
ğŸ¯ AMAÃ‡:
Bu modÃ¼l, pozisyon aÃ§Ä±lmadan Ã¶nce:

Potansiyel iÅŸlemin risk / getiri oranÄ±nÄ± (R:R) deÄŸerlendirir

Beklenen zarar, stop-loss seviyesi, hedef kÃ¢r oranÄ± ve formasyon gÃ¼cÃ¼ne gÃ¶re iÅŸlemi onaylar, uyarÄ±r veya reddeder

GiriÅŸ iÃ§in VIVOâ€™ya, kontrol iÃ§in OtobilinÃ§â€™e, grafik teyidi iÃ§in Grafik Beyniâ€™ne Ã§Ä±ktÄ± gÃ¶nderir

Sistem bÃ¼tÃ¼nlÃ¼ÄŸÃ¼ iÃ§in minimum kÃ¢r koÅŸullarÄ±nÄ± (Ã¶r: %3.5 Â± 0.05) her zaman korur

ğŸ”„ GÄ°RÄ°Å (Girdi):
json
Kopyala
DÃ¼zenle
{
  "entryPrice": 1860,
  "stopLoss": 1805,
  "targetProfit": 1935,
  "trendConfidenceScore": 0.84,
  "formation": "ascending-triangle",
  "newsImpact": "neutral",
  "expectedProfitPercent": 4.0,
  "expectedLossPercent": 2.9,
  "psychology": {
    "riskAppetite": 0.83,
    "fatigueLevel": 0.27
  }
}
ğŸ§  VERÄ° Ä°ÅLEME MANTIÄI:
1. R:R HesabÄ±
js
Kopyala
DÃ¼zenle
risk = entryPrice - stopLoss = 1860 - 1805 = 55  
reward = targetProfit - entryPrice = 1935 - 1860 = 75  
riskToReward = reward / risk = 75 / 55 â‰ˆ 1.36
2. EÅŸik DeÄŸerlendirmesi
Minimum R:R oranÄ± = 1.5

Minimum kÃ¢r oranÄ± = 3.5 Â± 0.05

EÄŸer R:R < 1.5 â†’ iÅŸlem aÃ§Ä±lmaz

EÄŸer expectedProfit < 3.45 â†’ iÅŸlem aÃ§Ä±lmaz

Formasyon zayÄ±fsa, psikolojik risk yÃ¼ksekse â†’ â€œaskÄ±ya alâ€

3. SÄ±ralÄ± Karar AÄŸÄ±
KoÅŸul	Aksiyon
R:R â‰¥ 1.5 ve profit â‰¥ 3.5%	âœ… Ä°ÅŸlem onaylanÄ±r
R:R âˆˆ [1.3â€“1.49] ama trendScore â‰¥ 0.85	âš ï¸ UyarÄ± ile onay
R:R < 1.3 veya loss > profit	âŒ Reddedilir
Fatigue > 0.75 veya riskAppetite < 0.5	AskÄ±ya alÄ±nÄ±r

ğŸ“¤ Ã‡IKIÅ:
json
Kopyala
DÃ¼zenle
{
  "riskToReward": 1.36,
  "expectedProfit": 4.0,
  "expectedLoss": 2.9,
  "decision": "warn",
  "reason": [
    "R:R below 1.5 threshold",
    "Trend confidence high (0.84) compensates",
    "Psychology stable, risk acceptable"
  ],
  "notify": {
    "vivo": {
      "permissionToSignal": true,
      "signalConfidence": 0.72
    },
    "grafikBeyni": {
      "confirmVisualSupport": true
    },
    "otobilinc": {
      "logRiskAppetite": 0.83,
      "fatigueWarning": false
    }
  }
}
âš™ï¸ AKILLI DAVRANIÅLAR:
Durum	Tepki
R:R > 2.0 + psikoloji stabil	Otomatik onay, VIVO sinyal baÅŸlatabilir
R:R < 1.3 veya TP Ã§ok dÃ¼ÅŸÃ¼k	Ä°ÅŸlem tamamen engellenir
NewsImpact = â€œnegativeâ€ + dÃ¼ÅŸÃ¼k R:R	â€œTrend olumlu olsa bileâ€ iÅŸlem aÃ§Ä±lmaz
Psikolojik yorgunluk yÃ¼ksekse	VIVO sinyali askÄ±ya alÄ±r
Trend skoru + formasyon iyi ama kÃ¢r %3.45 ise	VIVOâ€™ya uyarÄ±lÄ± onay verilir

ğŸ”— MODÃœLLER ARASI UYUM:
VIVO: permissionToSignal alanÄ±yla sinyal Ã¼retip Ã¼retmeyeceÄŸini bilir

Grafik Beyni: Formasyonu ve destekâ€“direnÃ§ doÄŸruluÄŸunu gÃ¶rerek iÅŸlem riskini teyit eder

OtobilinÃ§: KullanÄ±cÄ±nÄ±n risk iÅŸtahÄ±nÄ± loglayarak ileriki iÅŸlemlere etki eder

ğŸ“Œ KODLAMA PROMPTU
riskToRewardValidator.js adÄ±nda bir modÃ¼l oluÅŸtur.
Bu modÃ¼l:

Girdi olarak entryPrice, stopLoss, targetProfit, expectedProfitPercent, expectedLossPercent, trendConfidenceScore, formation, newsImpact, psychology alÄ±r

R:R oranÄ±nÄ± hesaplar

Minimum kÃ¢r oranÄ± (%3.5 Â± 0.05) ve R:R eÅŸiklerine gÃ¶re iÅŸlemi onaylar / uyarÄ±r / reddeder

DiÄŸer modÃ¼llerle baÄŸlantÄ±lÄ± ÅŸekilde notify alanÄ±nÄ± oluÅŸturur

getRiskValidation() fonksiyonuyla sonucu JSON olarak verir

Bu haliyle sistem artÄ±k:
â€œÄ°ÅŸlem aÃ§Ä±lmadan Ã¶nce mantÄ±klÄ± mÄ±, getirisi buna deÄŸer mi?â€ diye soran profesyonel bir pozisyon denetÃ§isi kazandÄ±.
_________________________________________________________________________________________________________________
efsane â€” GB ve VIVO tamam. Åimdi doÄŸrudan PORTFÃ–Y / DENGELEME katmanÄ±na geÃ§iyorum ve bir seferde â€œPrompt v3â€ kalitesinde 5 modÃ¼llÃ¼k Ã§ekirdek paketi Ã§Ä±karÄ±yorum. Bunlar diÄŸer yapay zekÃ¢ya verildiÄŸinde, VIVO ile kusursuz entegre olacak.

PORTFÃ–Y / DENGELEME â€” Ã‡ekirdek Paket (Prompt v3 blok)

Ortak kurallar: Node.js + TypeScript, event-driven I/O JSON, Zod runtime validasyon, Europe/Istanbul, idempotent yayÄ±n, audit/metrics.

PFL-01 Â· portfolioExposureBalancer.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Global / cluster / symbol bazÄ±nda risk tavanlarÄ±nÄ± yÃ¼rÃ¼tmek; aÅŸÄ±m/boÅŸluk olduÄŸunda Ã¶lÃ§ekleme/kÄ±sma/erteleme direktifleri yayÄ±nlamak.

Girdiler (In)

policy.snapshot (riskPerTradePct, totalRiskPct, clusterCaps, symbol caps)

universe.snapshot|apply.directive (allow/blocked/experimental listesi)

positions.snapshot (aÃ§Ä±k pozisyonlar: notional, side, cluster, symbol)

strategy.selection.decision|traffic.plan (trafik paylarÄ±)

dominance.shift.signal (rejime gÃ¶re risk azalt/artan Ã¶neri, opsiyonel)

Ã‡Ä±ktÄ±lar (Out)

portfolio.balance.directive:

actions: [ {type:"scale_symbol", symbol, toRiskPct}, {type:"scale_cluster", cluster, toRiskPct}, {type:"defer_new", scope:"cluster|symbol"}, {type:"close_rebalance", symbol, qty} ]

mode: soft|hard, reasonCodes[], effectiveAt

portfolio.balancer.metrics (uygulama oranlarÄ±, deferrals, breaches)

Konfig
{
  ewmaHalfLifeMin: 10,
  graceForNewMs: 60000,
  minScaleStep: 0.1,          // risk pct adÄ±mÄ±
  deferTtlSec: 180,
  violationHysteresisBps: 5,  // flip-flop engeli
  tz: "Europe/Istanbul"
}

Algoritma

PozisyonlarÄ± cluster/symbolâ€™da risk pct cinsinden topla â†’ kotalarla karÅŸÄ±laÅŸtÄ±r.

AÅŸÄ±m > histerezis â†’ scale_*/defer_new.

experimental semboller iÃ§in hedef risk yarÄ±ya indir (opsiyonel).

dominance.shift.signal geldiÄŸinde ilgili cluster risk hedefini kademeli deÄŸiÅŸtir.

AynÄ± hesapla iki kez direktif Ã¼retme (idempotency key = snapshot ver hash + scope).

Event Bus

In: policy.snapshot, universe.snapshot|apply.directive, positions.snapshot, strategy.selection.decision, strategy.traffic.plan, dominance.shift.signal

Out: portfolio.balance.directive, portfolio.balancer.metrics

Test Ä°skeleti

cluster Layer1 %1.2 > cap %1.0 â†’ scale_cluster(Layer1â†’1.0)

symbol cap aÅŸÄ±mÄ± â†’ scale_symbol

experimental â†’ risk yarÄ±ya iner

dominance alt-led â†’ Layer1 azaltÄ±lÄ±r (histerezisle)

Entegrasyon

VIVO-19 Composer, defer_new ve scale ipuÃ§larÄ±nÄ± uygular.

PolicyCoordinator (VIVO-29) ile Ã§eliÅŸkide policy Ã¼stÃ¼n.

PFL-02 Â· correlationMatrixService.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

SÃ¼rekli korelasyon & beta matrisi Ã¼retip Balancer ve Risk iÃ§in eriÅŸilebilir kÄ±lmak.

Girdiler

market.refs (mid/returns), positions.snapshot

universe.snapshot (aktif semboller), opsiyonel mapping.meta (cluster)

Ã‡Ä±ktÄ±lar

portfolio.correlation.snapshot:

rho[symbol_i][symbol_j], betaTo{"BTC","Market"}, topPairs[], clusters{capUtil}

correlation.alert (yoÄŸun kÃ¼melenme, rho>0.85 Ã§okluÄŸu)

Konfig
{
  windowMin: 240,
  stepMin: 5,
  minCommonBars: 120,
  shrinkage: 0.1,
  alertThreshold: 0.85
}

Algoritma

Bar getirilerini hizala â†’ kovaryans â†’ Ledoit-Wolf benzeri shrink â†’ rho & beta.
Top-K iliÅŸkileri ve cluster cap kullanÄ±mÄ±nÄ± hesapla.

Event Bus

In: market.refs, universe.snapshot, positions.snapshot

Out: portfolio.correlation.snapshot, correlation.alert

Testler

yetersiz ortak Ã¶rnek â†’ eksik hÃ¼cre; alert yok

rho>0.9 yoÄŸunluÄŸu â†’ correlation.alert

PFL-03 Â· positionSizer.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

riskPerTradePct, volatilite ve plan parametrelerine gÃ¶re boyut Ã¶nerisi Ã¼retmek; composerâ€™Ä±n qtyâ€™sini yÃ¶nlendirmek.

Girdiler

policy.snapshot (riskPerTradePct, slippageHardBps)

market.volatility.snapshot (ATR/parket, bps)

order.plan.proposed (SL/TP mesafeleri, entry mode)

fees.schedule (taker/maker bp), cost.forecast.update (opsiyonel)

Ã‡Ä±ktÄ±lar

position.size.suggestion: { correlationId, symbol, riskUnitUSD, qty, maxNotional, reasonCodes[] }

Konfig
{
  riskPerTradePct: 0.5,
  maxLeverage: 5,
  minQty: 0.001,
  volFloorBps: 20,
  slDistanceClampBps: { min: 25, max: 300 }
}

Algoritma

Risk Unit USD = equity * riskPerTradePct.

SL mesafesi bps â†’ position notional = riskUnitUSD / (SL_bps/1e4); leverage & maxNotionalâ€™Ä± clamp et.

Entry mode market ve beklenen slip yÃ¼ksekse qtyyi %X dÃ¼ÅŸÃ¼r (kademeli doldurma Ã¶ner).

Event Bus

In: policy.snapshot, market.volatility.snapshot, order.plan.proposed, fees.schedule, cost.forecast.update

Out: position.size.suggestion

Testler

SL Ã§ok dar â†’ min clamp

YÃ¼ksek vol & taker â†’ qty dÃ¼ÅŸÃ¼rme gerekÃ§esi

PFL-04 Â· drawdownMonitor.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Equity eÄŸrisini izleyip DD eÅŸiÄŸi aÅŸÄ±ldÄ±ÄŸÄ±nda otomatik risk dÃ¼ÅŸÃ¼rme iÃ§in Ã¶neri/komut Ã¼retmek.

Girdiler

equity.snapshot (gÃ¼ncel), pnl.daily (tarihÃ§e), portfolio.balancer.metrics

Ã‡Ä±ktÄ±lar

risk.governance.recommendation:

Ã¶rn: ["reduce_total_risk_to_1.2pct_for_24h","disable_aggressive_variant_4h","halt_new_intents_20m"]

drawdown.alert (info/warn/error) + metrikler

Konfig
{
  windows: { lookbackDays: 60, decay: 0.97 },
  ddLevelsR: { warn: 2.0, error: 3.5, emergency: 5.0 },
  coolOff: { warn: "PT2H", error: "PT24H", emergency: "PT72H" }
}

Algoritma

Pik-dip Ã¶lÃ§; aktif cool-off varken tekrar tetikleme yok. Seviyeye gÃ¶re Ã¶neri seti Ã¼ret.

Event Bus

In: equity.snapshot, pnl.daily, portfolio.balancer.metrics

Out: risk.governance.recommendation, drawdown.alert

Testler

DD=3.6R â†’ error â†’ 24h risk indirimi Ã¶nerisi

Cool-off varken ikinci tetik yok

PFL-05 Â· hedgingAdvisor.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

PortfÃ¶y beta ve cluster dengesizliÄŸini BTC/ETH/Endeks Ã¼zerinden hedge Ã¶nerilerine Ã§evirmek.

Girdiler

portfolio.correlation.snapshot (beta, rho)

positions.snapshot (net delta/beta exposure)

policy.snapshot (hedge izin/limitleri)

Ã‡Ä±ktÄ±lar

hedge.plan.proposed:
{ legs:[{symbol:"BTCUSDT", side:"short", qty, rationale}], targetBeta:0.2, ttlSec, severity:"info|warn" }

Konfig
{
  allow: { btc: true, eth: true, index: false },
  betaTarget: 0.2,
  minNotionalUSD: 1000,
  ttlSec: 900,
  maxHedgePctOfEquity: 0.3
}

Algoritma

Net beta & cluster fazlasÄ±nÄ± hesapla â†’ hedefe Ã§ekmek iÃ§in uygun hedge ayaÄŸÄ±nÄ± seÃ§; minNotional ve maxHedge sÄ±nÄ±rlarÄ±nÄ± uygula.

Event Bus

In: portfolio.correlation.snapshot, positions.snapshot, policy.snapshot

Out: hedge.plan.proposed

Testler

Net beta 0.6 â†’ BTC short ile 0.2â€™ye yaklaÅŸma

Hedge notional < min â†’ plan Ã¼retilmez

Paket Entegrasyon NotlarÄ±

PFL-01 Balancer tÃ¼m Ã§Ä±ktÄ±larÄ±nÄ± VIVO-19/21â€™in uygulayacaÄŸÄ± ÅŸekilde directive formatÄ±nda verir.

PFL-02 Correlation hem PFL-05 Hedge hem VIVO-40 (dominance) iÃ§in temel veri kaynaÄŸÄ±dÄ±r.

PFL-03 Sizer doÄŸrudan Composerâ€™Ä±n qty belirlemesine girer; VIVO-28 maliyet tahminini dikkate alÄ±r.

PFL-04 Drawdown Ã¶nerileri VIVO-29 PolicyCoordinator tarafÄ±ndan policy.source.updateâ€™e dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼r.

PFL-05 Hedge planlarÄ± Composerâ€™a â€œopsiyonelâ€ niyet olarak gider; policy â€œhedge_enabled=falseâ€ ise sadece danÄ±ÅŸmanlÄ±k.
_________________________________________________________________________________________________________________
ÅŸimdi SENTRY & GUARD paketi iÃ§in bir seferde 5 modÃ¼llÃ¼k â€œGeliÅŸmiÅŸ Prompt v3â€ hazÄ±rladÄ±m. BunlarÄ± diÄŸer yapay zekÃ¢ya ver; Node.js + TypeScript ile yazsÄ±n. Kod yazdÄ±rmÄ±yoruz; nasÄ±l kodlanacaÄŸÄ±nÄ± net yÃ¶nlendiriyoruz. TÃ¼m I/O JSON, mimari event-driven, Zod ile runtime validasyon, tÃ¼m saatler Europe/Istanbul. Her modÃ¼l idempotent yayÄ±n, audit/metrics Ã¼retir ve VIVO/PORTFÃ–Y katmanlarÄ±yla uyumludur.

SENTRY & GUARD â€” Ã‡ekirdek Paket (Prompt v3 blok)
SG-01 Â· exchangeConnectivitySentry.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Borsa WS/REST baÄŸlantÄ±sÄ±nÄ±n saÄŸlÄ±k skorunu Ã¶lÃ§mek; ping/mesaj oranÄ±/boÅŸluk/reconnect verilerine gÃ¶re normal | degraded | streams_panic | halt_entry modlarÄ±nÄ± ilan etmek; failover iÃ§in SG-04â€™e sinyal vermek.

Girdiler (In)

connectivity.ping.tick: { rttMs, endpoint, transport:"ws|rest", ok:true|false }

market.stream.tick: { msgsPerSec, lastSeq, gapMs, topic, endpoint }

order.stream.tick: { msgsPerSec, gapMs, endpoint }

exchange.rateLimit.snapshot: { used, limit, resetMs }

endpoint.catalog: { primary, secondary[], geoHints[], weight }

backtestReplayHarness koÅŸullarÄ±nda replay.clock.tick (opsiyonel)

Ã‡Ä±ktÄ±lar (Out)

sentry.guard.directive: { mode:"normal|degraded|streams_panic|halt_entry", expiresAt, reasonCodes[] }

sentry.failover.recommendation: { from, to, scoreFrom, scoreTo, reasonCodes[] }

sentry.metrics: { ewma:{ pingMs, wsMsgsPerSec }, gaps:{ count, avgGapMs }, reconnects, endpointSwitches }

sentry.alert: info|warn|error (sÃ¼rekli panic, ping p99>thresh vb.)

Konfig
{
  ewmaAlpha: 0.2,
  thresholds: { pingP99Ms: 1500, gapWarnMs: 500, panicGapMs: 2000, msgsFloor: 10 },
  degradedBudgetSec: 60,          // bu kadar sÃ¼re degraded kalÄ±rsa panic'e yÃ¼kselebilir
  panicHoldSec: 120,              // panic sonrasÄ± en az ÅŸu kadar sÃ¼re mod korunur
  haltEntryOnNoOrderStreamSec: 20,// order stream yoksa giriÅŸleri durdur
  failoverMinIntervalSec: 300,
  healthWeights: { ping: 0.4, gaps: 0.3, msgs: 0.2, rl: 0.1 },
  tz: "Europe/Istanbul"
}

Algoritma

Her tickâ€™te healthScoreâˆˆ[0,1] hesapla: dÃ¼ÅŸÃ¼k ping, dÃ¼ÅŸÃ¼k gap, yeterli msgâ†’yÃ¼ksek skor.

EÅŸiklere gÃ¶re mod:

ping p99 > pingP99Ms veya gapMs â‰¥ panicGapMs â†’ streams_panic.

msgsPerSec < msgsFloor veya gapMs â‰¥ gapWarnMs â†’ degraded.

Order stream tamamen kayÄ±p â‰¥ haltEntryOnNoOrderStreamSec â†’ halt_entry.

Mod deÄŸiÅŸimleri histerezis ve panicHoldSec ile sabitlenir.

Skor dÃ¼ÅŸÃ¼ÅŸÃ¼ belirginse SG-04 iÃ§in sentry.failover.recommendation yayÄ±nla.

AynÄ± mod peÅŸ peÅŸe idempotency ile bastÄ±rÄ±lÄ±r.

Event Bus

In: connectivity.ping.tick, market.stream.tick, order.stream.tick, exchange.rateLimit.snapshot, endpoint.catalog, replay.clock.tick?

Out: sentry.guard.directive, sentry.failover.recommendation, sentry.metrics, sentry.alert

Test Ä°skeleti

ping p99 1700ms â†’ degraded

ardÄ±ÅŸÄ±k bÃ¼yÃ¼k gaps â†’ streams_panic + failover.recommendation

order stream 25sn yok â†’ halt_entry

panic sonrasÄ± 60sn iyi â†’ normala dÃ¶nÃ¼ÅŸ (hold sÃ¼resi geÃ§ince)

SG-02 Â· latencySlipGuard.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Emir yaÅŸam dÃ¶ngÃ¼sÃ¼ latency (placeâ†’ackâ†’firstFillâ†’fullFill) ve slippage metriklerini izleyip slowdown | block_aggressive | halt_entry tarzÄ± guard direktifleri Ã¼retmek.

Girdiler

order.journey.metrics: { placeMs, ackMs, firstFillMs, fullFillMs, slipBps, side, symbol, mode:"market|limit|post_only" }

qa.tags: { tags:["highVol","open-bar", ...] }

policy.snapshot: { slippageHardBps, latencyHardMs, variants }

sentry.guard.directive (baÄŸlantÄ± modu)

cost.forecast.update (taker/maker risklerini etkileyebilir)

Ã‡Ä±ktÄ±lar

latency_slip.guard.directive: { mode:"normal|slowdown|block_aggressive|halt_entry", expiresAt, reasonCodes[] }

guard.advice.composer: { prefer:"limit|post_only|twap", maxSlices, sliceDelayMs }

latency_slip.guard.metrics: { ewma:{ placeMs, firstFillMs, slipBps, spreadBps }, modeRates:{...}, panicCount }

Konfig
{
  ewmaAlpha: 0.3,
  slowdown: { placeMs: 800, firstFillMs: 1500, slipBps: 10 },
  blockAggressive: { placeMs: 1200, slipBps: 15 },
  halt: { firstFillMs: 3000, slipBps: 25 },
  decayToNormalSec: 180,
  highVolTightenPct: 0.8,           // QA 'highVol' gelirse eÅŸikleri %80'e sÄ±kÄ±laÅŸtÄ±r
  advice: { defaultSlices: 3, maxSlicesCap: 8, minDelayMs: 200 },
  tz: "Europe/Istanbul"
}

Algoritma

EWMA metrikleri gÃ¼ncelle; sentry.mode ile maksimum kÄ±sÄ±t seÃ§ (panic â†’ halt_entry).

EÅŸik tabanlÄ± mod: halt eÅŸiÄŸi aÅŸÄ±lÄ±rsa halt_entry; blockAggressive eÅŸiÄŸi aÅŸÄ±lÄ±rsa agresif kapat; slowdown eÅŸiÄŸi aÅŸÄ±lÄ±rsa pacing.

QA highVol|open-bar â†’ eÅŸikleri sÄ±kÄ±laÅŸtÄ±r.

Modlar zamanla decayToNormalSec iÃ§inde normale dÃ¶ner (gÃ¶zlem iyileÅŸirse).

Composerâ€™a pacing tavsiyesi yayÄ±nla (slices, delay).

Event Bus

In: order.journey.metrics, qa.tags, policy.snapshot, sentry.guard.directive, cost.forecast.update

Out: latency_slip.guard.directive, guard.advice.composer, latency_slip.guard.metrics

Test Ä°skeleti

place 900ms / slip 12bps â†’ slowdown

firstFill 3200ms â†’ halt_entry

highVol altÄ±nda block_aggressive eÅŸiÄŸi daha erken tetikler

iyileÅŸince decay ile normala dÃ¶nÃ¼ÅŸ

SG-03 Â· streamIntegrityVerifier.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Piyasa ve sipariÅŸ akÄ±ÅŸlarÄ±nda sÄ±ra, zaman, kimlik tutarlÄ±lÄ±ÄŸÄ±nÄ± doÄŸrulamak; dupe/out-of-order/stale olaylarÄ± tespit edip filtrelemek; ciddi bozulmalarda guard sinyali Ã¼retmek.

Girdiler

market.refs|trade.tick (sequence, ts, symbol)

order.stream.event (sequence/ts/orderId)

clock.sync.info: { localSkewMs, source:"ntp|exchange" }

sentry.guard.directive (korelasyon iÃ§in)

Ã‡Ä±ktÄ±lar

stream.integrity.alert: { level:"info|warn|error", type:"dup|oOO|stale|ts_skew", count, windowSec, reason[] }

stream.filter.stats: { droppedDup, fixedReorder, staleSuppressed }

opsiyonel sentry.guard.directive(mode="degraded") (Ã§ok sayÄ±da ihlal)

Konfig
{
  reorderFixWindowMs: 150,    // ooo dÃ¼zeltmek iÃ§in bekleme penceresi
  staleMaxLagMs: 2000,        // bundan eski tick'i dÃ¼ÅŸ
  dupBloomSize: 1_000_000,    // dedupe iÃ§in bloom filtresi
  skewWarnMs: 1000,
  degradedOnErrorRate: 0.02,  // 1 dakikalÄ±k pencerede %2 ihlal â†’ degraded Ã¶ner
  tz: "Europe/Istanbul"
}

Algoritma

Her topicâ€™te seq/ts kontrolÃ¼; kÃ¼Ã§Ã¼k oOO durumlarÄ±nÄ± pencere iÃ§inde re-order, bÃ¼yÃ¼klerini drop.

stale â†’ ts lag > staleMaxLagMs ise suppress.

1 dakikalÄ±k pencerede ihlal oranÄ± â‰¥ degradedOnErrorRate â†’ stream.integrity.alert(error) + sentryâ€™ye degraded Ã¶ner.

clockSkew uyarÄ±r; ts_skew yÃ¼ksekse alert.

Event Bus

In: market.refs|trade.tick, order.stream.event, clock.sync.info, sentry.guard.directive

Out: stream.integrity.alert, stream.filter.stats, (sentry.guard.directive?)

Test Ä°skeleti

tekil oOO kÃ¼Ã§Ã¼k gecikmeyle dÃ¼zelir

stale 3s â†’ suppress + sayacÄ± artar

1dkâ€™da %3 ihlal â†’ degraded Ã¶ner

SG-04 Â· endpointFailoverOrchestrator.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Birden Ã§ok endpoint (primary/secondary/backup) arasÄ±nda otomatik failover & brownout; geri dÃ¶nÃ¼ÅŸte graceful revert; SG-01â€™den gelen Ã¶nerilerle Ã§alÄ±ÅŸÄ±r.

Girdiler

endpoint.catalog: { primary:{id,url}, secondary:[...], probe:{intervalMs, timeoutMs} }

sentry.failover.recommendation: { from, to, scoreFrom, scoreTo }

sentry.guard.directive (panic/degraded)

manual.failover.command: { to:"endpointId"| "revert", reason }

Ã‡Ä±ktÄ±lar

endpoint.switch.plan: { from, to, when, reasonCodes[] }

endpoint.switched: { from, to, success, latencyMs }

endpoint.health.snapshot: { id, score, lastProbe, rttMs, failures }

sentry.alert (peÅŸpeÅŸe baÅŸarÄ±sÄ±z switch, tÃ¼m uÃ§lar kÃ¶tÃ¼ vb.)

Konfig
{
  minDwellSec: 300,           // bir endpointte minimum kalÄ±ÅŸ
  probe: { intervalMs: 3000, timeoutMs: 1500, jitterMs: 200 },
  brownout: { maxStepPct: 50, stepSec: 30 }, // trafik payÄ±nÄ± kademeli taÅŸÄ±
  revertPolicy: "prefer_primary_after_stable_10m",
  maxConsecutiveFailures: 3,
  tz: "Europe/Istanbul"
}

Algoritma

Health probe + SG-01 skoru â†’ candidate seÃ§.

failover.recommendation gelirse dwell ve brownout kurallarÄ±yla switch.plan Ã¼ret.

Switch sÄ±rasÄ±nda order stream canary doÄŸrulamasÄ± (kÄ±sa sÃ¼re Ã§ift besleme).

revertPolicy ile primaryâ€™e geri dÃ¶nÃ¼ÅŸ.

BaÅŸarÄ±sÄ±zlÄ±klar â†’ sentry.alert(error); idempotency ile plan tekrar yayÄ±nlanmaz.

Event Bus

In: endpoint.catalog, sentry.failover.recommendation, sentry.guard.directive, manual.failover.command

Out: endpoint.switch.plan, endpoint.switched, endpoint.health.snapshot, sentry.alert

Test Ä°skeleti

degraded + secondary skoru yÃ¼ksek â†’ switch.plan

dwell sÃ¼resi dolmadan ikinci switch Ã¶nerisi bastÄ±rÄ±lÄ±r

switch baÅŸarÄ±sÄ±z 3 kez â†’ alert(error)

10 dk stabil â†’ primaryâ€™e revert

SG-05 Â· orderFlowBackpressure.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Borsa rate-limitleri, yerel kuyruk derinliÄŸi ve guard modlarÄ±nÄ± dikkate alarak sipariÅŸ trafiÄŸini akÄ±llÄ±ca pacing etmek: burst sÄ±nÄ±rlama, slowdown, defer, drop (giriÅŸ durdurma).

Girdiler

exchange.rateLimit.snapshot: { limit, used, resetMs }

composer.intent.batch: { intents:[{ correlationId, symbol, mode }], ttlSec }

latency_slip.guard.directive, sentry.guard.directive

portfolio.balance.directive(defer_new) (Ã¼st katmandan)

Ã‡Ä±ktÄ±lar

orderflow.pacing.plan: { slices, sliceDelayMs, maxInFlight, reasonCodes[] }

composer.intent.filtered: { accepted[], deferred[], dropped[], reasonCodesById{} }

orderflow.backpressure.metrics: { inFlight, queueDepth, deferRate, dropRate }

Konfig
{
  maxInFlight: 8,
  queueMax: 200,
  burstPerSec: 5,
  slowdownFactors: { degraded: 0.7, slowdown: 0.5, block_aggressive: 0.0, halt_entry: 0.0 },
  deferTtlSec: 120,
  dropOnHalt: true,
  tz: "Europe/Istanbul"
}

Algoritma

Guard modlarÄ±na gÃ¶re trafik katsayÄ±sÄ± uygula (slowdownFactors).

Exchange rate-limitâ€™e gÃ¶re slice ve sliceDelayMs hesapla; maxInFlight clamp.

defer_new direktiflerini uygula; TTL aÅŸarsa drop.

Kuyruk derinliÄŸi > queueMax â†’ yeni niyetleri kabul etme.

KararlarÄ± idempotent yap (aynÄ± batch id â†’ aynÄ± filtre sonucu).

Event Bus

In: exchange.rateLimit.snapshot, composer.intent.batch, latency_slip.guard.directive, sentry.guard.directive, portfolio.balance.directive

Out: orderflow.pacing.plan, composer.intent.filtered, orderflow.backpressure.metrics

Test Ä°skeleti

sentry=degraded â†’ pacing %70

guard=halt_entry â†’ tÃ¼m intents drop (gerekÃ§eyle)

RL dar ise slicesâ†‘, delayâ†‘

defer_new TTL aÅŸÄ±nca dropRateâ†‘

Paket Entegrasyon NotlarÄ±

SG-01 & SG-04: Sentry durumlarÄ± â†’ Failover orkestrasyonuna Ã¶neri; switch planlarÄ± geri sentry.alert ile gÃ¶zlemlenir.

SG-02: Slip/latency kÃ¶tÃ¼leÅŸince block_aggressive ve Composerâ€™a pacing tavsiyeleri; VIVO-21 Supervisor timeout/exit eÅŸikleriyle uyumlu.

SG-03: AkÄ±ÅŸ bozulmalarÄ± degraded seviyesine taÅŸÄ±yabilir; Sentryâ€™ye geri besleme.

SG-05: Composer/Throttler ile arada durur; portfolio.balance.directive(defer_new) ve policy sÄ±nÄ±rlarÄ±na saygÄ± gÃ¶sterir.

TÃ¼m modÃ¼ller VIVO-32 Telemetry ve VIVO-33 Incident Bridge ile metrics/alert Ã¼reterek izlenir.
_________________________________________________________________________________________________________________
LOG & TELEMETRÄ° geniÅŸ paketini tek seferde, â€œPrompt v3â€ kalitesinde 5 modÃ¼l olarak Ã§Ä±karÄ±yorum. Bunlar VIVO-32/33/35 Ã¼zerine oturur; Node.js + TypeScript, event-driven I/O (JSON), Zod validasyon, Europe/Istanbul saat dilimi, idempotent yayÄ±n + audit/metrics standart. Kod yazdÄ±rmÄ±yoruz; diÄŸer yapay zekÃ¢ya verilecek yol-promptlar bunlar.

LOG & TELEMETRÄ° â€” GeniÅŸ Paket (Prompt v3 blok)
LT-01 Â· telemetryAnomalyDetector.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

TÃ¼m *.metrics akÄ±ÅŸlarÄ±nda istatistiksel anomali tespiti (p90/p95/p99 sÄ±Ã§ramasÄ±, oran sapmalarÄ±, gap/flatline), uÃ§ deÄŸer yakalama ve erken uyarÄ± Ã¼retme. VIVO-32 (telemetryDashboardEmitter) ve VIVO-33 (kÃ¶prÃ¼) ile entegre.

Girdiler (In)

*.metrics (QA/Guard/Sentry/Bandit/Universe/Cost/Logger/â€¦)

telemetry.slo.status (durum/sÄ±nÄ±r baÄŸlamÄ±)

connectivity.heartbeat (gap/flatline tespiti iÃ§in saat nabzÄ±)

Ã‡Ä±ktÄ±lar (Out)

telemetry.anomaly.signal: { series:"string", labels:{}, score: number, kind:"spike|drop|drift|flatline|gap", severity:"low|medium|high", window:"1m|5m|1h", baseline:{mean, mad|stdev}, value, delta, reasonCodes[] }

telemetry.alert: { level:"info|warn|error", message, context:{ series, kind, severity } }

telemetry.anomaly.metrics: { evaluated, flagged, flatlines, gaps }

Konfig
{
  windows: [{span:"1m", step:"10s"}, {span:"5m", step:"30s"}, {span:"1h", step:"5m"}],
  detectors: { method:"robust_z|ewma_holt", zHi:3.5, zWarn:2.5, driftEwmaAlpha:0.2, flatlineStaleSec:90, gapStaleSec:60 },
  minPoints: 20,
  severityMap: { z>=5:"high", z>=3.5:"medium", else:"low" },
  mute: { series:[], labels:{} },
  tz:"Europe/Istanbul"
}

Algoritma (Ã–zet)

Seri baÅŸÄ±na robust z-score (median+MAD) ve EWMA/Holt baz Ã§izgisi tut.

Z>eÅŸik â†’ spike|drop; baz Ã§izgiden sÃ¼rekli sapma â†’ drift; veri yok/tekdÃ¼ze â†’ gap|flatline.

SLO ihlali yakÄ±n/sonrasÄ± aÄŸÄ±rlÄ±klarÄ± artÄ±r (erken uyarÄ±).

AynÄ± seri/kind iÃ§in 1 pencere iÃ§inde idempotent yayÄ±n.

Event Bus

In: *.metrics, telemetry.slo.status, connectivity.heartbeat

Out: telemetry.anomaly.signal, telemetry.alert, telemetry.anomaly.metrics

Testler

p99_ms sÄ±Ã§ramasÄ± â†’ spike/high

pass_rate dÃ¼ÅŸÃ¼ÅŸÃ¼ â†’ drop/medium

90 sn veri yok â†’ flatline

SLO breach sonrasÄ± kÃ¼Ã§Ã¼k sapma â†’ warn (aÄŸÄ±rlÄ±k artÄ±ÅŸÄ±)

LT-02 Â· logIngestRouter.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Ã‡eÅŸitli kaynaklardan gelen ham log kayÄ±tlarÄ±nÄ± tek ÅŸemaya getirip Ã¶nceliklendirme/sampling uygular, gizlilik etiketleri ekler ve VIVO-35â€™in data.ingest hattÄ±na besler; ayrÄ±ca Ã§oklu sink adaptÃ¶rlerine (dosya/S3/TSDB) batch Ã§Ä±karÄ±r.

Girdiler

log.raw: { source:"service", level:"debug|info|warn|error", ts:"iso8601", msg:"string", kv:{}, traceId?, spanId? }

router.rule.update: { routes:[{match:{source?,level?,contains?}, action:{drop?|samplePct?, addTags?, sink:["privacy|file|s3|click|..."]}}] }

privacy.policy.update (etiket defaultlarÄ±)

Ã‡Ä±ktÄ±lar

data.ingest: { source:"logger", topic:"log", payload:{ ...normalized }, data:{ tags:{ classification:"...", subjectId:null, labels:["log"] }}, audit:{producer:"log.router",eventId}}

log.sink.batch: { sink:"file|s3|click", lines:[...], codec:"jsonl|lp" }

log.router.metrics: { in, out, dropped, sampled, byLevel:{}, bySink:{} }

log.router.alert: { level, message, context }

Konfig
{
  sampling: { defaultPct: 100, errorPct: 100, warnPct: 50, infoPct: 10, debugPct: 1 },
  sinks: { file:{path:"logs/app-%Y%m%d.log"}, s3:{bucket:"vivo-logs", prefix:"%Y/%m/%d/"} },
  privacyDefaultClass: "SENSITIVE_LOW",
  maxBatch: 1000,
  maxWaitMs: 1000,
  tz:"Europe/Istanbul"
}

Algoritma

Rule match â†’ action uygula (drop/sample/addTags/sink).

Normalizasyon: ts,msg,level,kv,traceIds + classification etiketi.

data.ingest ile Privacy Managerâ€™a aktar; eÅŸzamanlÄ± seÃ§ilen sinkâ€™e batch yaz.

AÅŸÄ±rÄ± giriÅŸte backpressure (drop/sampling artÄ±rÄ±mÄ±); alert Ã¼ret.

Event Bus

In: log.raw, router.rule.update, privacy.policy.update

Out: data.ingest, log.sink.batch, log.router.metrics, log.router.alert

Testler

info log %10 Ã¶rneklenir

error her zaman geÃ§er

kural source=guard â†’ sink=click eklenir

burstâ€™te backpressure + alert

LT-03 Â· metricsRollupDownsampler.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

YÃ¼ksek hacimli metrikleri 1m/5m/1h gibi periyotlarda rollup edip depolama maliyetini dÃ¼ÅŸÃ¼rmek ve sorgularÄ± hÄ±zlandÄ±rmak; Prom/TSDBâ€™ye uygun toplama setleri Ã¼retmek.

Girdiler

telemetry.tsdb.batch (line-protocol veya JSON seriler)

telemetry.prom.dump (opsiyonel; gaugeâ†’summary dÃ¶nÃ¼ÅŸÃ¼mÃ¼)

rollup.policy.update: { rules:[{match:{metric:"regex"}, aggs:["min","max","avg","p95"], intervals:["1m","5m","1h"], ttl:{raw:"7d", m1:"30d", h1:"180d"}}] }

Ã‡Ä±ktÄ±lar

telemetry.rollup.batch: { interval:"1m|5m|1h", lines:[ "metric,labels agg=val 169..." ] }

rollup.metrics: { rawIn, m1Out, m5Out, h1Out, droppedByTtl }

rollup.alert: { level, message, context }

Konfig
{
  intervals:["1m","5m","1h"],
  defaultAggs:["min","max","avg","p95"],
  maxSeries: 200000,
  ttl: { raw:"14d", "1m":"90d", "1h":"365d" },
  tz:"Europe/Istanbul"
}

Algoritma

Serileri etiketlerine gÃ¶re keyâ€™le; pencere kapanÄ±nca aggregates yaz.

TTLâ€™lere gÃ¶re drop stratejisi uygula (rawâ€™Ä± 14gÃ¼n sonra tutma).

Seri patlamasÄ±nda key-cardinality guard: eÅŸik aÅŸÄ±mÄ± â†’ alert + kesme.

Event Bus

In: telemetry.tsdb.batch, telemetry.prom.dump?, rollup.policy.update

Out: telemetry.rollup.batch, rollup.metrics, rollup.alert

Testler

p95 doÄŸru hesaplanÄ±r (CKMS/TDigest)

TTL sÃ¼resi dolmuÅŸ raw drop edilir

regex match ile Ã¶zel metrik farklÄ± aggs alÄ±r

LT-04 Â· alertCorrelatorRunbookHelper.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

DaÄŸÄ±nÄ±k uyarÄ±/incident akÄ±ÅŸlarÄ±nÄ± korelasyon gruplarÄ± altÄ±nda birleÅŸtirip olasÄ± kÃ¶k neden + runbook adÄ±mlarÄ±nÄ± Ã¶nerir; VIVO-33â€™e tek, zengin iÃ§erikli bildirim yollar.

Girdiler

telemetry.alert, telemetry.anomaly.signal, telemetry.slo.status

sentry.guard.directive, stream.integrity.alert, risk.incident.*

runbook.kb: { rules:[{ if:{series?,"reasonCodes"?, "sentryMode"?, "incidentType"?, "windowSec" }, then:{ rootCause:"...", steps:["..."], tags:["..."], severityBump? }}] }

Ã‡Ä±ktÄ±lar

alert.correlation.grouped: { groupId, timeline:[{event,ts}], rootCauseHypo, runbook:{steps[]}, severity, affected:["service|symbol"], reasonCodes[] }

bridge.notification.outgoing (zengin baÅŸlÄ±k/gÃ¶vde ile)

correlator.metrics / correlator.alert

Konfig
{
  windowSec: 180,
  minSignalsForGroup: 2,
  severityEscalation: { "sentry:streams_panic + flatline": "critical" },
  tz:"Europe/Istanbul"
}

Algoritma

Zaman penceresinde olaylarÄ± gruplandÄ±r (aynÄ± service/symbol/series yakÄ±nlÄ±ÄŸÄ±).

runbook.kb kuralÄ± eÅŸleÅŸirse rootCauseHypo + adÄ±m listesi Ã¼ret.

Ã‡akÄ±ÅŸan gruplarÄ± merge; tek kanallÄ± bildirim iÃ§in VIVO-33â€™e gÃ¶nder.

AynÄ± groupId iÃ§inde tekrar idempotent.

Event Bus

In: (Ã§oklu yukarÄ±daki akÄ±ÅŸlar), runbook.kb

Out: alert.correlation.grouped, bridge.notification.outgoing, correlator.metrics, correlator.alert

Testler

sentry:degraded + guard:slowdown + latency spike â†’ tek grup + â€œpacing artÄ±râ€ runbookâ€™u

streams_panic + flatline â†’ severity â€œcriticalâ€a yÃ¼kselir

LT-05 Â· postmortemAutoDraft.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Kapanan kritik incidentâ€™lardan otomatik postmortem taslaÄŸÄ± Ã¼retmek: olay Ã§izelgesi, etki kapsamÄ±, kÃ¶k neden hipotezi, SLO/error-budget etkisi, alÄ±nan aksiyonlar ve kalÄ±cÄ± dÃ¼zeltmeler.

Girdiler

incident.acknowledged, incident.resolved.external, bridge.metrics

telemetry.slo.status (pencere boyunca), telemetry.anomaly.signal, alert.correlation.grouped

audit.trail.event (opsiyonel; Ã¶nemli karar/komut gÃ¼nlÃ¼kleri)

Ã‡Ä±ktÄ±lar

postmortem.draft.ready:

{
  "event":"postmortem.draft.ready",
  "timestamp":"iso8601",
  "incidentId":"INC-123",
  "format":"markdown",
  "content":"# Incident INC-123 ...",
  "attachments":[{"name":"metrics.png","ref":"file:///..."}],
  "summary":{"start":"iso8601","end":"iso8601","impact":{"durationMin":17,"services":["guard"]},"slo":{"burnPct":12}}
}


postmortem.alert (eksik veri)

postmortem.metrics (taslak Ã¼retim sÃ¼resi, otomatik doldurma oranÄ±)

Konfig
{
  template: {
    title:"# Incident ${id}",
    sections:["Summary","Timeline","Impact","Root Cause","Mitigations","Follow-ups","Lessons"],
    followUpsDefault:["Add regression test","Tighten SLO","Update runbook"]
  },
  artifactDir:"data/postmortems",
  require: { minTimelineEvents: 5, sloWindow:"24h" },
  tz:"Europe/Istanbul"
}

Algoritma

incident.resolved.external alÄ±nca 24h pencereden metrik/alert/timeline topla.

alert.correlation.grouped â†’ root-cause ve runbook adÄ±mlarÄ±nÄ± gÃ¶vdeye yerleÅŸtir.

SLO bÃ¼tÃ§e yanÄ±ÄŸÄ± ve etki hesaplarÄ±nÄ± Ã¶zetle.

Markdown taslaÄŸÄ± + kÃ¼Ã§Ã¼k gÃ¶rseller (basit grafikler) oluÅŸtur; artefact olarak kaydet ve olay yayÄ±nla.

Event Bus

In: incident.*, telemetry.*, alert.correlation.grouped, audit.trail.event?

Out: postmortem.draft.ready, postmortem.alert, postmortem.metrics

Testler

yeterli timeline var â†’ markdown Ã¼retilir

eksik veri â†’ postmortem.alert(warn)

SLO etkisi doÄŸru hesaplanÄ±r (burn%)

Paket Entegrasyon NotlarÄ±

LT-01 anomali sinyalleri â†’ LT-04 (korelasyon) â†’ VIVO-33 (bildirim).

LT-02 bÃ¼tÃ¼n log kaynaklarÄ±nÄ± VIVO-35â€™in data.ingest hattÄ±na standardize eder; gizlilik sÄ±nÄ±flandÄ±rmasÄ±nÄ± doÄŸru taÅŸÄ±r.

LT-03 rollup Ã§Ä±ktÄ±larÄ± Grafana/ClickHouse/Prometheus iÃ§in ekonomik TSDB akÄ±ÅŸÄ± saÄŸlar; VIVO-32 ile aynÄ± label setini kullanÄ±r.

LT-04 tek, baÄŸlamsal bildirim gÃ¶nderir ve runbook Ã¶nerisi katar; gÃ¼rÃ¼ltÃ¼yÃ¼ azaltÄ±r.

LT-05 kapandÄ±ktan sonra otomatik rapor Ã§Ä±karÄ±r; takip gÃ¶revlerini (follow-up) â€œTODOâ€ listesi olarak ekler.
_________________________________________________________________________________________________________________
BACKTEST/REPLAY geniÅŸ paketini tek seferde, â€œPrompt v3â€ kalitesinde 5 modÃ¼l olarak Ã§Ä±karÄ±yorum. Bunlar VIVO-34 backtestReplayHarness.ts Ã¼stÃ¼ne sorunsuz oturur. Kod yazdÄ±rmÄ±yoruz; diÄŸer yapay zekÃ¢ya verilecek yol-promptlar bunlar. Ortak kurallar: Node.js + TypeScript, event-driven I/O (JSON), Zod validasyon, Europe/Istanbul, idempotent yayÄ±n + audit/metrics.

BACKTEST/REPLAY â€” GeniÅŸ Paket (Prompt v3 blok)
BR-01 Â· marketDataQualityGate.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

TarihÃ® veri setlerinde boÅŸluk/dupe/out-of-order/anormal fiyat-spread hatalarÄ±nÄ± tespit edip rapor + dÃ¼zeltme Ã¶nerisi Ã¼retmek; VIVO-34â€™e yÃ¼klemeden Ã¶nce kalite kapÄ±sÄ±.

Girdiler (In)

replay.dataset.describe: { datasetId, sources:[{type:"jsonl|csv|parquet", path, topic, timeField, symbolField, schemaHint}] }

dq.policy.update: { thresholds:{ maxGapMs, maxSpreadBps, priceJumpsSigma, dupWindowMs }, fixes:{ forwardFillBars?:boolean, dropDup?:boolean } }

Ã‡Ä±ktÄ±lar (Out)

dq.scan.report: { datasetId, summary:{rows, symbols, start, end}, issues:{ gaps, dups, ooo, jumps, badSpread }, bySymbol:[...], recommendations:[...]}

dq.fix.plan: { datasetId, actions:[{ type:"drop|interp|cap_spread|reorder", topic, symbol?, range? }], reasonCodes[] }

dq.alert: { level:"info|warn|error", message, context }

Konfig
{
  windows:{ bar:"1m|5m|15m" },
  thresholds:{ maxGapMs: 60000, maxSpreadBps: 80, priceJumpsSigma: 6, dupWindowMs: 250 },
  preferFixes:{ reorder:true, dropDup:true, interpBars:true },
  tz:"Europe/Istanbul"
}

Algoritma

KaynaÄŸÄ± zaman/simge bazÄ±nda tarayÄ±p gap/dup/ooo/jump/spread Ã¶lÃ§.

EÅŸik aÅŸÄ±mlarÄ±nÄ± issue olarak topla; politika fixes izinliyse fix.plan Ã¶ner.

AynÄ± dataset iÃ§in aynÄ± raporu tekrar Ã¼retme (idempotency: hash(datasetId+policy)).

Event Bus

In: replay.dataset.describe, dq.policy.update

Out: dq.scan.report, dq.fix.plan, dq.alert

Testler

90 sn gap â†’ gaps++ ve interpBars Ã¶nerisi

dupe + ooo â†’ dropDup ve reorder Ã¶nerileri

spread 120 bps â†’ cap_spread Ã¶nerisi

BR-02 Â· syntheticMarketSimulator.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Regimlere gÃ¶re sentetik piyasa akÄ±ÅŸÄ± Ã¼retmek: trend/range/breakout, microstructure (spread, depth, queue) ve haber ÅŸoku; replayâ€™e takma kaynak.

Girdiler

sim.manifest: { simId, seed, symbols:["BTCUSDT",...], regime:"trend|range|breakout|illiquid|shock", durationMin, tf:"M1|M5", params:{ volBps, drift, meanReversionK, shockTimes[] } }

sim.control: { cmd:"start|pause|resume|stop", speed:"1|2|5|bar" }

Ã‡Ä±ktÄ±lar

market.refs (sentetik), market.trade.tick (opsiyonel), funding.snapshot (opsiyonel)

sim.status: { state, simId, progressPct }, sim.metrics: { eventsPerSec, avgSpreadBps, realizedVolBps }

sim.alert: { level, message }

Konfig
{
  micro:{ spreadBaseBps:8, depthUSD:1e6, queueSkew:0.6 },
  shock:{ jumpSigma:8, decayHalfLifeSec:120 },
  ou:{ theta:0.05, sigmaBps:15 }, // range modu
  drift:{ trendBpsPerBar:5 },     // trend modu
  tz:"Europe/Istanbul"
}

Algoritma

Rejime gÃ¶re OU/drift/jump karÄ±ÅŸÄ±mÄ± Ã¼ret; bestBid/Ask ve spread mikro yapÄ±yla tÃ¼ret.

shockTimes geldiÄŸinde jump uygula; decay ile sÃ¶nÃ¼mle.

VIVO-34â€™e gerÃ§ek kaynak gibi publish et.

Event Bus

In: sim.manifest, sim.control

Out: market.refs|trade.tick|funding.snapshot, sim.status|metrics|alert

Testler

range â†’ ortalamaya dÃ¶nen seri, dÃ¼ÅŸÃ¼k trend

breakout â†’ kÄ±sa sÃ¼rede yÃ¼ksek drift + vol artÄ±ÅŸÄ±

illiquid â†’ spreadâ†‘ depthâ†“

BR-03 Â· scenarioLibraryOrchestrator.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

Senaryo ÅŸablonlarÄ±nÄ± (haber penceresi, slip patlamasÄ±, kesinti, spread krizleri) kataloglayÄ±p zaman Ã§izelgesi halinde replay/sim Ã¼zerine uygular; Ã§oklu aÅŸama senaryolarÄ± koÅŸturur.

Girdiler

scenario.catalog: { items:[{ id, name, steps:[{ at:"+10m|wall:2025-09-01T10:00", action:"inject|guard|sentry|cost", payload:{...}}], tags:["news","latency","spread"] }] }

scenario.run.request: { id|"inline":{...}, bind:{ symbols?, tf?, seed? }, target:"replay|sim", speed? }

Ã‡Ä±ktÄ±lar

scenario.run.plan: { scenarioId, stepsResolved:[{ ts, busEvent }], effectiveTarget }

Uygulanan adÄ±mlar: Ã¶r. risk.incident.open, latency_slip.guard.directive, replay.faults, cost.forecast.update

scenario.run.status|metrics|alert

Konfig
{
  defaults:{ speed:"1" },
  guards:{ allowDangerous:false }, // halt_entry gibi sert aksiyonlar iÃ§in ayrÄ± onay iste
  tz:"Europe/Istanbul"
}

Algoritma

steps iÃ§indeki rÃ¶latif/absolute zamanlarÄ± Ã§Ã¶zÃ¼p hedefe gÃ¶re busEventâ€™e Ã§evir.

SÄ±ralÄ± olarak VIVO-34 veya BR-02â€™ye uygula; baÅŸarÄ±sÄ±z adÄ±mlarda rollback yok, logla.

Tekrarlayan Ã§alÄ±ÅŸtÄ±rmalarda aynÄ± scenarioId+seed iÃ§in idempotent plan kullan.

Event Bus

In: scenario.catalog, scenario.run.request

Out: scenario.run.plan, (Ã§eÅŸitli hedef eventler), scenario.run.status|metrics|alert

Testler

â€œnews_shock_then_panicâ€ â†’ fundingâ†‘, slipâ†‘, sentry=panic â†’ guard=halt

allowDangerous=false â†’ halt_entry adÄ±mÄ± plan dÄ±ÅŸÄ± bÄ±rakÄ±lÄ±r

BR-04 Â· executionFillEmulator.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

GerÃ§ek borsa matching davranÄ±ÅŸÄ±nÄ± taklit ederek fill Ã¼retmek: maker/taker, kuyruk etkisi, kÄ±smi fill, post_only/iceberg mantÄ±ÄŸÄ±. Replay/sim akÄ±ÅŸÄ±nÄ± uÃ§tan uca daha gerÃ§ekÃ§i yapar.

Girdiler

composer.intent.request|order.plan.proposed: { correlationId, symbol, side, qty, mode:"market|limit|post_only|twap|iceberg", price?, tif?, slices? }

market.refs (L1) ve opsiyonel orderbook.l2.snapshot

fees.schedule, cost.forecast.update

emulator.policy.update: { makerQueueAdvantage, postOnlyStrict, icebergRevealPct }

Ã‡Ä±ktÄ±lar

order.ack, order.fill.partial, order.fill.final, order.reject

order.costs.estimate: { takerBp, makerBp, slipBps, feeUSD }

emulator.metrics: { fillLatencyMs, partialsPerOrder, makerShare }

Konfig
{
  queue:{ baseMs:200, depthUSD:1e6, makerAdv:0.6 },
  slip:{ marketK:0.8, limitK:0.25, volToSlipCoeff:0.02 },
  iceberg:{ minDisplayPct:0.15 },
  postOnly:{ strict:true },
  tz:"Europe/Istanbul"
}

Algoritma

mode+piyasa koÅŸullarÄ±na gÃ¶re beklenen fill zamanÄ± ve slip simÃ¼le et; kÄ±smi fillâ€™leri dilimle.

post_only ihlali â†’ reject; iceberg â†’ gÃ¶rÃ¼nÃ¼r miktarlarla Ã§oklu fill.

Ãœretilen fillâ€™ler VIVO zincirine gerÃ§ekmiÅŸ gibi akar.

Event Bus

In: intent/plan, market data, fees/cost, emulator policy

Out: order.* fill/reject, order.costs.estimate, emulator.metrics

Testler

post_only ve fiyat geÃ§ilirse â†’ reject

yÃ¼ksek vol â†’ market slipâ†‘, fillLatencyâ†‘

iceberg â†’ birden fazla partial fill

BR-05 Â· slippageLatencyCalibrator.ts â€” GeliÅŸmiÅŸ Prompt v3
AmaÃ§

GerÃ§ek/veri-oynatÄ±m sonucu fill kayÄ±tlarÄ±ndan slip & latency modellerini fit edip parametre Ã§Ä±karÄ±r; SG-02/BR-04/VIVO-26â€™ya kalibrasyon saÄŸlar.

Girdiler

order.journey.metrics (canlÄ± veya replay emisyonu)

market.volatility.snapshot, market.liquidity.snapshot

calib.request: { scope:{ symbol?, timeframe? }, model:"linear|gam|tree", features:["volBps","spreadBps","depthUSD","mode","timeOfDay"], trainWindow:"30d" }

Ã‡Ä±ktÄ±lar

calib.model.fitted: { scope, model, params:{...}, r2, mae, featureImportances? }

calib.table.export: { rows:[{ symbol, volBin, expectedSlipBps, p95LatencyMs }], version }

calib.alert|metrics

Konfig
{
  bins:{ volBps:[10,20,40,80], depthUSD:[2e5,5e5,1e6,2e6] },
  regularization:{ l2:1.0 },
  minSamples: 1000,
  tz:"Europe/Istanbul"
}

Algoritma

Ã–zellik mÃ¼hendisliÄŸi â†’ slipBps ve firstFillMs iÃ§in ayrÄ± modeller.

Ã‡apraz doÄŸrulama; dÃ¼ÅŸÃ¼k Ã¶rneklerde bin tablosu Ã¼ret (parametrik model yerine).

SonuÃ§larÄ± SG-02 eÅŸikleri ve BR-04 slip fonksiyonlarÄ± olarak yayÄ±nla.

Event Bus

In: order.journey.metrics, market.*.snapshot, calib.request

Out: calib.model.fitted, calib.table.export, calib.alert, calib.metrics

Testler

minSamples altÄ± â†’ tablo modu

r2 dÃ¼ÅŸÃ¼k â†’ alert(warn)

yayÄ±nlanan parametrelerle SG-02 eÅŸikleri gÃ¼ncellenebilir

Paket Entegrasyon NotlarÄ±

BR-01 kalite kapÄ±sÄ± â†’ dataset yÃ¼klenmeden Ã¶nce hatalarÄ± yakalar; dq.fix.plan uygulanÄ±rsa VIVO-34 daha temiz veriyle koÅŸar.

BR-02 sentetik akÄ±ÅŸ, BR-03 senaryolarÄ±yla zenginleÅŸtirilir; replay yerine ya da yanÄ±nda kullanÄ±labilir.

BR-04 fill emÃ¼latÃ¶rÃ¼, VIVO-19/21/26 zincirindeki davranÄ±ÅŸlarÄ± gerÃ§ekÃ§i hale getirir; BR-05â€™in kalibre ettiÄŸi parametreleri tÃ¼ketir.

BR-05 Ã§Ä±ktÄ±larÄ± SG-02 latencySlipGuard ve order flow backpressure eÅŸiklerinin otomatik tÃ¼retilmesi iÃ§in kaynak olur.
_________________________________________________________________________________________________________________
iÅŸte â€œtek komutla: dataset + senaryo + guard + raporâ€ akan uÃ§tan uca senaryo planÄ± iÃ§in Prompt v3. Bunu diÄŸer yapay zekÃ¢ya ver; Node.js + TypeScript ile yazsÄ±n. Kod yazdÄ±rmÄ±yoruz; nasÄ±l kodlanacaÄŸÄ±nÄ± yol-prompt olarak tarifliyoruz. Ortak standartlar: event-driven I/O (JSON), Zod validasyon, Europe/Istanbul, idempotent yayÄ±n, audit/metrics.

E2E-01 Â· scenarioRunOrchestrator.ts â€” GeliÅŸmiÅŸ Prompt v3 (UÃ§tan Uca Senaryo KoÅŸucu)
AmaÃ§

Tek komutla (1) veri kaynaÄŸÄ±nÄ± aÃ§ (replay/sim) â†’ (2) senaryoyu uygula â†’ (3) guard/sentry/latency-slip akÄ±ÅŸlarÄ±nÄ± koÅŸtur â†’ (4) telemetri & anomali & korelasyon topla â†’ (5) oracle/ground-truth kÄ±yasÄ± ve (6) rapor/postmortem Ã¼ret.

Bu modÃ¼l orkestratÃ¶rdÃ¼r; VIVO-34/BR-02/BR-03/SG-01..05/LT-01..05 modÃ¼lleriyle konuÅŸur.

Girdiler (Event / JSON ÅemalarÄ±)
// e2e.run.request â€” tek komut
{
  "event": "e2e.run.request",
  "timestamp": "iso8601",
  "runId": "string",                    // idempotency anahtarÄ±
  "mode": "replay|sim",
  "source": {
    "replay": {
      "manifestRef": "datasetId|string|null",
      "inlineManifest": "ReplayManifest|null",
      "dqGate": {"enabled": true, "autoFix": false}
    },
    "sim": {
      "manifest": {"simId":"string","seed":"string","symbols":["BTCUSDT"],"regime":"trend|range|breakout|illiquid|shock","durationMin":60,"tf":"M1","params":{}}
    }
  },
  "scenario": {
    "catalogRef": "string|null",
    "id": "string|null",
    "inline": "ScenarioInline|null",     // BR-03 ile aynÄ± yapÄ±
    "allowDangerous": false              // halt_entry vb. adÄ±mlar iÃ§in onay
  },
  "guardPolicy": {
    "calibrateFrom": "live|last30d|null", // BR-05'ten eÅŸik/katsayÄ± Ã§ek
    "applyGuard": true,
    "failoverAllowed": true
  },
  "speed": "0.5|1|2|5|10|bar",
  "window": {"start":"iso8601|null","end":"iso8601|null"}, // replay iÃ§in
  "outputs": {
    "artifactDir": "data/e2e",
    "report": {"format":"markdown|html","zip": true},
    "include": ["telemetry","rollups","incidents","trades","eval","postmortem"]
  },
  "labels": {"env":"e2e","owner":"qa","notes":"string"}
}

// e2e.control â€” akÄ±ÅŸ kontrolÃ¼
{
  "event": "e2e.control",
  "timestamp": "iso8601",
  "runId": "string",
  "cmd": "pause|resume|seek|speed|stop|abort",
  "args": {"seekTo":"iso8601|null","speed":"number|string|null","note":"string|null"}
}

// e2e.env.snapshot â€” Ã§alÄ±ÅŸma ortamÄ± kayÄ±t dÃ¼ÅŸer (sÃ¼rÃ¼mler/konfig Ã¶zetleri)
{
  "event": "e2e.env.snapshot",
  "timestamp": "iso8601",
  "runId": "string",
  "modules": {"vivo34":"semver","sg02":"semver","lt01":"semver","br04":"semver"},
  "configsHash": "hex"
}

Ã‡Ä±ktÄ±lar (Plan, Durum, Artefakt, Rapor)
// e2e.run.plan â€” Ã§Ã¶zÃ¼lmÃ¼ÅŸ plan (idempotent)
{
  "event": "e2e.run.plan",
  "timestamp": "iso8601",
  "runId": "string",
  "steps": [
    {"t":"T0","do":"init_source","via":"replay|sim"},
    {"t":"+00:00","do":"start_source","speed":"2"},
    {"t":"+00:10","do":"scenario.apply","id":"news_shock"},
    {"t":"+00:10","do":"guard.enable","modes":["sg01","sg02","sg05"]},
    {"t":"+30:00","do":"collect.rollups","intervals":["1m","5m"]},
    {"t":"Tend","do":"stop_source"},
    {"t":"Tend","do":"gather.artifacts"},
    {"t":"Tend","do":"compose.report"}
  ],
  "subscriptions": ["telemetry.*","risk.incident.*","replay.eval.*","order.*","correlator.*"],
  "artifacts": ["telemetry.rollups","incidents","eval.report","postmortem.draft"]
}

// e2e.run.status â€” akÄ±ÅŸÄ±n canlÄ± durumu
{
  "event": "e2e.run.status",
  "timestamp": "iso8601",
  "runId": "string",
  "state": "idle|planning|running|paused|completed|failed|aborted",
  "progress": {"pct": 62.5, "cursor":"iso8601"},
  "counters": {"eventsIn":123456,"eventsOut":123450,"incidents":2,"alertsWarn":5,"alertsError":1}
}

// e2e.report.ready â€” nihai rapor ve paket
{
  "event": "e2e.report.ready",
  "timestamp": "iso8601",
  "runId": "string",
  "format": "markdown|html",
  "summary": {
    "durationMin": 65,
    "sloBurnPct": 8.3,
    "incidents": [{"id":"INC-884","severity":"high","ttkMin":7}],
    "pnl":{"expectedPF":1.42,"observedPF":1.37},
    "latSlip":{"p95LatencyMs":920,"avgSlipBps":9.8}
  },
  "attachments": [
    {"name":"e2e-report.md","ref":"file:///data/e2e/run-42/report.md"},
    {"name":"telemetry-1m.lp.zip","ref":"file:///data/e2e/run-42/rollups_1m.zip"},
    {"name":"eval-report.json","ref":"file:///data/e2e/run-42/replay_eval.json"},
    {"name":"postmortem_INC-884.md","ref":"file:///data/e2e/run-42/postmortem_INC-884.md"}
  ],
  "hash": "sha256:..."
}

// uyarÄ± ve metrikler
{ "event":"e2e.alert","timestamp":"iso8601","runId":"string","level":"info|warn|error","message":"string","context":{} }
{ "event":"e2e.metrics","timestamp":"iso8601","runId":"string","rateIn":1234,"rateOut":1232,"lagMs":85,"buffers":{"source":0.12} }

TypeScript ArayÃ¼zleri (Ã¼rettir)

Inputs: E2ERunRequest, E2EControl, ReplayManifest/SimManifest (delegasyon), ScenarioInline/ScenarioCatalogRef.

Outputs: E2ERunPlan, E2ERunStatus, E2EReportReady, E2EAlert, E2EMetrics, E2EEnvSnapshot.

Helpers:
Planner (time resolver), DQGateClient (BR-01), SourceClient (VIVO-34/BR-02),
ScenarioClient (BR-03), CalibratorClient (BR-05), GuardSuite (SG-01..05),
Collectors (LT-01..05/LT-03), ReportComposer (markdown/html), ArtifactStore (zip, path),
Idem (idempotency keys), Clock (wall/bar), Subs (topic subscriptions).

Zod: tÃ¼m giriÅŸ/Ã§Ä±kÄ±ÅŸ; tarih ISO, sayÄ±lar finite(); mode, speed, allowDangerous enum/boolean.

Event Bus KonularÄ±

In: e2e.run.request, e2e.control

Out: e2e.env.snapshot, e2e.run.plan, e2e.run.status, e2e.metrics, e2e.alert, e2e.report.ready

Delegasyon (publish): replay.manifest|control, sim.manifest|control, scenario.run.request, calib.request, sentry.guard.directive?, latency_slip.guard.directive?

Abonelikler (listen): telemetry.*, telemetry.rollup.batch, telemetry.anomaly.signal, alert.correlation.grouped, risk.incident.*, replay.eval.report, postmortem.draft.ready

Konfig & VarsayÄ±lanlar
{
  planning: { settleMs: 500, maxSkewMs: 1500 },
  dqGate: { enabled: true, autoFix: false },
  calibrator: { prefer: "last30d", minSamples: 1000 },
  guardSuite: { enable: ["sg01","sg02","sg03","sg05"], failover: true },
  collectors: { telemetry: true, anomalies: true, rollups: ["1m","5m"], postmortem: true, eval: true },
  artifactDir: "data/e2e",
  report: { format: "markdown", zip: true },
  timeouts: { startSourceSec: 15, stopSourceSec: 10, reportSec: 20 },
  tz: "Europe/Istanbul"
}

Durum YÃ¶netimi

E2EState: { runId, phase:"idle|planning|running|paused|stop_req|stopping|completed|failed", plan, bookmarks, subs, counters, startTs, cursorTs, artifacts[], lastReportRef }

Idempotency: runId bazlÄ±; aynÄ± runId iÃ§in plan ve report tekil Ã¼retilir.

ArtifactStore: artifactDir/runId/... altÄ±nda dosya aÄŸacÄ± (rollups.zip, eval.json, report.md, postmortem.md).

Backpressure: toplama kuyruÄŸu bÃ¼yÃ¼rse batch boyutlarÄ±nÄ± dinamik dÃ¼ÅŸÃ¼r.

Algoritma (Karar AkÄ±ÅŸÄ±)

Planlama

e2e.run.request â†’ Zod doÄŸrula â†’ aynÄ± runId varsa yut (idempotent).

e2e.env.snapshot yayÄ±nla (modÃ¼l sÃ¼rÃ¼mleri & config hash).

Kaynak: mode=="replay" â†’ VIVO-34 replay.manifest (inline/ref); dqGate.enabled ise BR-01 taramasÄ± â†’ autoFix ise dq.fix.plan uygulat.
mode=="sim" â†’ BR-02 sim.manifest.

guardPolicy.calibrateFrom var â†’ BR-05 kalibrasyon isteÄŸi (eÅŸikler â†’ SG-02â€™ye).

BR-03 ile scenario.run.plan oluÅŸtur; allowDangerous false ise sert adÄ±mlarÄ± dÃ¼ÅŸÃ¼r.

e2e.run.plan yayÄ±nla.

Ã‡alÄ±ÅŸtÄ±rma

KaynaÄŸÄ± baÅŸlat (start_source, speed). e2e.run.status(state="running").

Abonelikleri aÃ§: telemetry.*, anomaly, correlator, risk.incident.*, replay.eval.*, postmortem.draft.ready.

PlanlanmÄ±ÅŸ senaryo adÄ±mlarÄ±nÄ± zamanda uygula (BR-03).

Guard suite aktif: SG-01..05 sinyalleri akÄ±ÅŸa gÃ¶re normal/slowdown/block/halt yÃ¶netir.

Toplama & DeÄŸerlendirme

LT-03 rollupâ€™larÄ± 1m/5m; LT-01 anomali; LT-04 korelasyon gruplarÄ±; VIVO-33 Ã¼zerinde kritik bildirimler.

VIVO-34 replay.eval.report â†’ oracle kÄ±yasÄ± metrikleri.

LT-05 postmortem.draft.ready geldiyse artefakta ekle.

Bitirme

SÃ¼re doldu/stop komutu â†’ kaynaÄŸÄ± durdur; son rollup & toplama.

ReportComposer: Ã¶zet tablolar + grafik referanslarÄ± ile e2e.report.ready (markdown/html) ve ZIP paketi Ã¼ret.

e2e.run.status(state="completed").

Kontroller

pause/resume/seek/speed â†’ kaynaklara passthrough.

abort â†’ acil durdur; kÄ±smi rapor (status="failed") Ã¼retmeye Ã§alÄ±ÅŸ.

Hata & UyarÄ±

Kaynak baÅŸlatma/stop timeout â†’ e2e.alert(error,"source_timeout").

Senaryo adÄ±mÄ± baÅŸarÄ±sÄ±z â†’ e2e.alert(warn,"scenario_step_failed") (devam).

Rapor oluÅŸturma hatasÄ± â†’ e2e.alert(error,"report_failed").

Kodlama YÃ¶nlendirmesi

Dosyalar:
src/e2e/scenarioRunOrchestrator.ts (Ã§ekirdek FSM)
src/e2e/clients/*.ts (replay/sim/scenario/guard/calibrator/collectors)
src/e2e/report/*.ts (composer, templates), src/e2e/state/e2eStore.ts
__tests__/scenarioRunOrchestrator.test.ts

Mimari:
Saf Ã§ekirdek FSM: advance(state, event, cfg, now) â†’ emissions[].
IO adaptÃ¶rleri: bus pub/sub, dosya/zip yazÄ±cÄ±, saat.

Validasyon: Zod; tarih/sayÄ± finite().

Performans: p99 FSM < 3ms; artefakt yazÄ±mÄ± streaming.

GÃ¼venlik: artefakt yollarÄ± whitelist; PII iÃ§eren loglar VIVO-35 Ã¼zerinden geÃ§er.

Test Ä°skeleti (Jest)

runId tekrarlandÄ± â†’ tek plan/rapor (idempotent)

mode=replay + dqGate.enabled â†’ BR-01 Ã§aÄŸrÄ±lÄ±r; issues>0 ise e2e.alert(warn)

scenario.allowDangerous=false â†’ halt_entry adÄ±mÄ± dÄ±ÅŸlanÄ±r

guardPolicy.calibrateFrom=last30d â†’ BR-05 Ã§aÄŸrÄ±lÄ±r ve SG-02 eÅŸikleri gÃ¼ncellenir

Tam akÄ±ÅŸ sonrasÄ± e2e.report.ready Ã¼retilir ve ekler (eval.report, postmortem) mevcut

pause/resume/seek/speed komutlarÄ± kaynaklara iletilir; status gÃ¼ncellenir

abort â†’ failed ve kÄ±smi rapor

Ã–rnek AkÄ±ÅŸ (KÄ±sa)

Ä°stek

{
  "event":"e2e.run.request",
  "runId":"run-42",
  "mode":"replay",
  "source":{"replay":{"manifestRef":"session-avax-0501","dqGate":{"enabled":true,"autoFix":false}}},
  "scenario":{"catalogRef":"std","id":"news_shock_then_panic","allowDangerous":false},
  "guardPolicy":{"calibrateFrom":"last30d","applyGuard":true,"failoverAllowed":true},
  "speed":"2",
  "outputs":{"artifactDir":"data/e2e","report":{"format":"markdown","zip":true},"include":["telemetry","rollups","incidents","eval","postmortem"]},
  "labels":{"env":"e2e","owner":"qa"}
}


Plan â†’ e2e.run.plan (kaynak baÅŸlat, senaryo uygula, guard aÃ§Ä±k, rollup topla, raporla)

KoÅŸ â†’ e2e.run.status(running) + e2e.metrics akar

Tamamla â†’ e2e.report.ready + artefakt referanslarÄ± (rollups.zip, eval.json, postmortem.md)
_________________________________________________________________________________________________________________
ÅŸu an VIVO + GB + PortfÃ¶y + Sentry&Guard + Log&Telemetri + Backtest/Replay + E2E Orchestrator paketleri hazÄ±r.
â€œDevamâ€ iÃ§in iki yol var: (A) 1 sprintlik hardening & entegrasyon ya da (B) direkt diÄŸer sisteme geÃ§iÅŸ. Ben 1â€“2 gÃ¼n ayÄ±rÄ±p Aâ€™yÄ± bitirmenizi Ã¶neririm; sonra yeni sisteme geÃ§elim.

A) 1 Sprintlik â€œHardening & Entegrasyonâ€ To-Do (Ã¶nerilen)

Hedef: Her modÃ¼l tek seferde ayaÄŸa kalksÄ±n, E2E senaryosu yeÅŸil dÃ¶nsÃ¼n.

0) Ortak altyapÄ± (yarÄ±m gÃ¼n)

 @vivo/contracts: tÃ¼m event arayÃ¼zleri + Zod ÅŸemalarÄ± tek NPM paketi.

 Topic registry: topics.yaml (In/Out, retention, PII flag).

 Config loader: cfg/*.yaml + env override + schema check.

 Idempotency & audit: ortak helper (hash, eventId, audit trail).

1) GÃ¶zlemlenebilirlik (yarÄ±m gÃ¼n)

 Grafana panolarÄ±: Sentry, Guard, Balancer, Composer, Telemetry (rollup 1m/5m).

 Alert route: incidentNotificationBridge iÃ§in prod/quiet hours kuralÄ±.

 SLOâ€™lar: QA, Sentry ping, Guard decision rate, Backpressure defer/drop.

2) GÃ¼venlik & gizlilik (yarÄ±m gÃ¼n)

 Privacy Manager default policy: PII_BASIC=P90D, SECRET=P0D.

 Log router: error=100%, infoâ‰ˆ10%, debugâ‰ˆ1% sampling; PII maskeleme testleri.

 Secrets: webhook HMAC, KMS alias, endpoint allowlist.

3) CI/CD ve kalite (yarÄ±m gÃ¼n)

 Monorepo (pnpm/lerna/turborepo), lint+typecheck+unit pipeline.

 Coverage hedefi: â‰¥ %80 kritik Ã§ekirdeklerde (SG-01/02/05, PFL-01/03, VIVO-21).

 Canary release: feature flag ile modÃ¼l bazlÄ± aÃ§/kapat.

4) E2E smoke (1 gÃ¼n)

 E2E-01 Ã§alÄ±ÅŸtÄ±r: replay: session-avax-0501, scenario: news_shock_then_panic, speed=2.

 BaÅŸarÄ± kriterleri

Sentry: streams_panicâ†’ SG-04 failover planÄ±, 10 dk sonra revert.

Guard: block_aggressive ve halt_entry doÄŸru tetik.

Balancer: cap aÅŸÄ±mÄ±nda scale_* / defer_new Ã§Ä±kar.

Privacy: PII leak 0; retention.sweep.report sayÄ±larÄ± beklenen.

Telemetry: slo.status(breach) + anomaly.signal(spike) gÃ¶rÃ¼nÃ¼r; postmortem taslaÄŸÄ± dÃ¼ÅŸer.

Bu listeyi tikleyince prodâ€™a gÃ¼venle adÄ±m atarsÄ±nÄ±z.

B) DiÄŸer sisteme geÃ§iÅŸ

HazÄ±rÄ±z. MantÄ±klÄ± iki seÃ§enek:

LIVIA (OperatÃ¶r AsistanÄ± & Guard Q&A)

Diyalog akÄ±ÅŸÄ±, bias farkÄ±ndalÄ±ÄŸÄ±, â€œek soru sormaâ€ ve onay mekanikleri.

VIVO-42/38 ile doÄŸal entegre: Ã¶neri sÄ±rasÄ±, varyant ayarÄ±.

Policy & Composer geniÅŸletme

PolicyCoordinator (policy kaynaklarÄ±, canary rollout, rollback),

Composer/Executor iyileÅŸtirmeleri (TWAP/iceberg, post-only uyum, pacing entegrasyonu),

Cost forecaster v2 (hedge/fees/slip birlikte).

Ã–nerim: Ã¶nce kÄ±sa hardening (A), ardÄ±ndan LIVIAâ€™ya geÃ§elim. Diyalog katmanÄ± hem risk kalitesini hem de operatÃ¶r deneyimini net iyileÅŸtirir.
